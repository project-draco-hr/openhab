{
  logger.debug("Received data from CUL: " + data);
  MaxCulMsgType msgType=BaseMsg.getMsgType(data);
  if (((pairMode && isBroadcast) || BaseMsg.isForUs(data,this.srcAddr)) && msgType == MaxCulMsgType.PAIR_PING) {
    logger.debug("Got PAIR_PING message");
    PairPingMsg pkt=new PairPingMsg(data);
    Collection<MaxCulBindingConfig> bindingConfigs=getBindingsBySerial(pkt.serial);
    for (    MaxCulBindingConfig bc : bindingConfigs)     bc.setPairedInfo(pkt.srcAddrStr);
    PairingInitialisationSequence ps=new PairingInitialisationSequence(this.DEFAULT_GROUP_ID,this.tzStr,messageHandler);
    messageHandler.startSequence(ps,pkt);
  }
 else {
switch (msgType) {
case WALL_THERMOSTAT_CONTROL:
      WallThermostatControlMsg wallThermCtrlMsg=new WallThermostatControlMsg(data);
    wallThermCtrlMsg.printMessage();
  for (  MaxCulBindingProvider provider : super.providers) {
    Collection<MaxCulBindingConfig> bindingConfigs=provider.getConfigsForRadioAddr(wallThermCtrlMsg.srcAddrStr);
    for (    MaxCulBindingConfig bc : bindingConfigs) {
      if (bc.feature == MaxCulFeature.THERMOSTAT && wallThermCtrlMsg.getDesiredTemperature() != null) {
        String itemName=provider.getItemNameForConfig(bc);
        eventPublisher.postUpdate(itemName,new DecimalType(wallThermCtrlMsg.getDesiredTemperature()));
      }
 else       if (bc.feature == MaxCulFeature.TEMPERATURE && wallThermCtrlMsg.getMeasuredTemperature() != null) {
        String itemName=provider.getItemNameForConfig(bc);
        eventPublisher.postUpdate(itemName,new DecimalType(wallThermCtrlMsg.getMeasuredTemperature()));
      }
    }
  }
if (isBroadcast == false) this.messageHandler.sendAck(wallThermCtrlMsg);
break;
case SET_TEMPERATURE:
SetTemperatureMsg setTempMsg=new SetTemperatureMsg(data);
setTempMsg.printMessage();
for (MaxCulBindingProvider provider : super.providers) {
Collection<MaxCulBindingConfig> bindingConfigs=provider.getConfigsForRadioAddr(setTempMsg.srcAddrStr);
for (MaxCulBindingConfig bc : bindingConfigs) {
if (bc.feature == MaxCulFeature.THERMOSTAT) {
String itemName=provider.getItemNameForConfig(bc);
eventPublisher.postUpdate(itemName,new DecimalType(setTempMsg.getDesiredTemperature()));
}
}
}
if (isBroadcast == false) this.messageHandler.sendAck(setTempMsg);
break;
case THERMOSTAT_STATE:
ThermostatStateMsg thermStateMsg=new ThermostatStateMsg(data);
thermStateMsg.printMessage();
for (MaxCulBindingProvider provider : super.providers) {
Collection<MaxCulBindingConfig> bindingConfigs=provider.getConfigsForRadioAddr(thermStateMsg.srcAddrStr);
for (MaxCulBindingConfig bc : bindingConfigs) {
String itemName=provider.getItemNameForConfig(bc);
if (bc.feature == MaxCulFeature.THERMOSTAT && thermStateMsg.getDesiredTemperature() != null) {
eventPublisher.postUpdate(itemName,new DecimalType(thermStateMsg.getDesiredTemperature()));
}
 else if (bc.feature == MaxCulFeature.TEMPERATURE && thermStateMsg.getMeasuredTemperature() != null) {
eventPublisher.postUpdate(itemName,new DecimalType(thermStateMsg.getMeasuredTemperature()));
}
 else if (bc.feature == MaxCulFeature.BATTERY) {
eventPublisher.postUpdate(itemName,thermStateMsg.getBatteryLow() ? OnOffType.ON : OnOffType.OFF);
}
 else if (bc.feature == MaxCulFeature.MODE) {
eventPublisher.postUpdate(itemName,new DecimalType(thermStateMsg.getControlMode().toInt()));
}
}
}
if (isBroadcast == false) this.messageHandler.sendAck(thermStateMsg);
break;
case WALL_THERMOSTAT_STATE:
WallThermostatStateMsg wallThermStateMsg=new WallThermostatStateMsg(data);
wallThermStateMsg.printMessage();
for (MaxCulBindingProvider provider : super.providers) {
Collection<MaxCulBindingConfig> bindingConfigs=provider.getConfigsForRadioAddr(wallThermStateMsg.srcAddrStr);
for (MaxCulBindingConfig bc : bindingConfigs) {
String itemName=provider.getItemNameForConfig(bc);
if (bc.feature == MaxCulFeature.THERMOSTAT && wallThermStateMsg.getDesiredTemperature() != null) {
eventPublisher.postUpdate(itemName,new DecimalType(wallThermStateMsg.getDesiredTemperature()));
}
 else if (bc.feature == MaxCulFeature.TEMPERATURE && wallThermStateMsg.getMeasuredTemperature() != null) {
eventPublisher.postUpdate(itemName,new DecimalType(wallThermStateMsg.getMeasuredTemperature()));
}
 else if (bc.feature == MaxCulFeature.BATTERY) {
eventPublisher.postUpdate(itemName,wallThermStateMsg.getBatteryLow() ? OnOffType.ON : OnOffType.OFF);
}
 else if (bc.feature == MaxCulFeature.MODE) {
eventPublisher.postUpdate(itemName,new DecimalType(wallThermStateMsg.getControlMode().toInt()));
}
}
}
if (isBroadcast == false) this.messageHandler.sendAck(wallThermStateMsg);
break;
default :
logger.debug("Unhandled message type " + msgType.toString());
break;
}
}
}
