{
  ItemBean bean;
  if (item instanceof GroupItem && drillDown) {
    GroupItem groupItem=(GroupItem)item;
    GroupItemBean groupBean=new GroupItemBean();
    Collection<ItemBean> members=new HashSet<ItemBean>();
    for (    Item member : groupItem.getMembers()) {
      members.add(createItemBean(member,false,null,null));
    }
    groupBean.members=members.toArray(new ItemBean[members.size()]);
    bean=groupBean;
  }
 else {
    String state=stateClass == null ? item.getState().toString() : item.getStateAs(stateClass).toString();
    String name=clientItemName == null ? item.getName() : clientItemName;
    bean=new ItemBean(name,state);
  }
  return bean;
}
