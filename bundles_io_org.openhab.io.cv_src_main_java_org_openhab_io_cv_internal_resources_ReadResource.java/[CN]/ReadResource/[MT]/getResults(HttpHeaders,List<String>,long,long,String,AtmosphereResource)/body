{
  final String responseType=MediaTypeHelper.getResponseMediaType(headers.getAcceptableMediaTypes());
  if (logger.isDebugEnabled()) {
    logger.debug("Received HTTP GET request at '{}' for {} items at index '{}', ResponseType: '{}'.",uriInfo.getPath(),itemNames.size(),index,responseType);
  }
  List<ReturnType> rts=getReturnTypes(itemNames);
  if (index == 0) {
    if (responseType != null) {
      throw new WebApplicationException(Response.ok(getItemStateListBean(rts,System.currentTimeMillis()),responseType).build());
    }
 else {
      throw new WebApplicationException(Response.notAcceptable(null).build());
    }
  }
  BroadcasterFactory broadcasterFactory=resource.getAtmosphereConfig().getBroadcasterFactory();
  CometVisuBroadcaster itemBroadcaster=broadcasterFactory.lookup(CometVisuBroadcaster.class,resource.getRequest().getPathInfo(),true);
  itemBroadcaster.addStateChangeListener(new ItemStateChangeListener(rts));
  return new SuspendResponse.SuspendResponseBuilder<Response>().scope(SCOPE.REQUEST).resumeOnBroadcast(!ResponseTypeHelper.isStreamingTransport(resource.getRequest())).broadcaster(itemBroadcaster).outputComments(true).build();
}
