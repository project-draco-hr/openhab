{
  if (initialized) {
    if (!isConnected()) {
      connectToDatabase();
    }
    SimpleDateFormat mysqlDateFormat=new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
    if (isConnected()) {
      String itemName=filter.getItemName();
      String table=sqlTables.get(itemName);
      if (table == null) {
        logger.error("SQL: Unable to find table for query '" + itemName + "'.");
        return Collections.emptyList();
      }
      String filterString=new String();
      if (filter.getBeginDate() != null) {
        if (filterString.isEmpty())         filterString+=" WHERE";
 else         filterString+=" AND";
        filterString+=" TIME>'" + mysqlDateFormat.format(filter.getBeginDate()) + "'";
      }
      if (filter.getEndDate() != null) {
        if (filterString.isEmpty())         filterString+=" WHERE";
 else         filterString+=" AND";
        filterString+=" TIME<'" + mysqlDateFormat.format(filter.getEndDate().getTime()) + "'";
      }
      if (filter.getOrdering() == Ordering.ASCENDING) {
        filterString+=" ORDER BY 'Time' ASC";
      }
 else {
        filterString+=" ORDER BY Time DESC";
      }
      if (filter.getPageSize() != 0x7fffffff)       filterString+=" LIMIT " + filter.getPageNumber() * filter.getPageSize() + "," + filter.getPageSize();
      try {
        long timerStart=System.currentTimeMillis();
        Statement st=connection.createStatement();
        String queryString=new String();
        queryString="SELECT Time, Value FROM " + table;
        if (!filterString.isEmpty())         queryString+=filterString;
        logger.debug("SQL: " + queryString);
        st.setFetchSize(50);
        ResultSet rs=st.executeQuery(queryString);
        long count=0;
        double value;
        List<HistoricItem> items=new ArrayList<HistoricItem>();
        while (rs.next()) {
          count++;
          value=rs.getDouble(2);
          State v=new DecimalType(value);
          SqlItem sqlItem=new SqlItem(itemName,v,rs.getTimestamp(1));
          items.add(sqlItem);
        }
        rs.close();
        st.close();
        long timerStop=System.currentTimeMillis();
        logger.debug("SQL: query returned {} rows in {}ms",count,timerStop - timerStart);
        errCnt=0;
        return items;
      }
 catch (      SQLException e) {
        errCnt++;
        logger.error("SQL: Error running querying : " + e.getMessage());
      }
    }
  }
  return Collections.emptyList();
}
