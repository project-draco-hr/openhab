{
  final HttpServletRequest request=event.getResource().getRequest();
  stateChangeListener=new StateChangeListener(){
    private volatile Boolean fired=false;
    public void stateUpdated(    Item item,    State state){
    }
    public void stateChanged(    Item item,    State oldState,    State newState){
synchronized (fired) {
        if (!fired || !isResumingTransport(request)) {
          fired=true;
          try {
            Thread.sleep(200);
          }
 catch (          InterruptedException e) {
          }
          event.getResource().getBroadcaster().broadcast(getResponseObject(event));
        }
      }
    }
  }
;
  registerStateChangeListenerOnRelevantItems(request,stateChangeListener);
}
