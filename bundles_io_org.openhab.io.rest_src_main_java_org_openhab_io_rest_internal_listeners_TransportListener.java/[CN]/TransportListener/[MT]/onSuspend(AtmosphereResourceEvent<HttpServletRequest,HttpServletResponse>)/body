{
  final HttpServletRequest request=event.getResource().getRequest();
  if (!isAtmosphereTransport(request)) {
    event.getResource().resume();
    return;
  }
  stateChangeListener=new StateChangeListener(){
    private volatile Boolean fired=false;
    public void stateUpdated(    Item item,    State state){
    }
    public void stateChanged(    Item item,    State oldState,    State newState){
synchronized (fired) {
        if (!fired || !isResumingTransport(request)) {
          fired=true;
          event.getResource().getBroadcaster().broadcast(getResponseObject(event));
        }
      }
    }
  }
;
  registerStateChangeListenerOnRelevantItems(request,stateChangeListener);
}
