{
  logger.debug("Creating new SerialMessage from buffer = " + SerialMessage.bb2hex(buffer));
  messageLength=buffer.length - 2;
  byte messageCheckSumm=calculateChecksum(buffer);
  byte messageCheckSummReceived=buffer[messageLength + 1];
  logger.debug(String.format("Message checksum calculated = 0x%02X, received = 0x%02X",messageCheckSumm,messageCheckSummReceived));
  if (messageCheckSumm == messageCheckSummReceived) {
    logger.trace("Checksum matched");
    isValid=true;
  }
 else {
    logger.trace("Checksum error");
    isValid=false;
    return;
  }
  this.messageType=buffer[2] == 0x00 ? SerialMessageType.Request : SerialMessageType.Response;
  ;
  this.messageClass=SerialMessageClass.getMessageClass(buffer[3] & 0xFF);
  this.messagePayload=ArrayUtils.subarray(buffer,4,messageLength + 1);
  this.messageNode=nodeId;
  logger.debug("Message Node ID = " + getMessageNode());
  logger.debug("Message payload = " + SerialMessage.bb2hex(messagePayload));
}
