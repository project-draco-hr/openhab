{
  ItemUIRegistry itemUIRegistry=RESTApplication.getItemUIRegistry();
  Sitemap sitemap=getSitemap(sitemapName);
  if (sitemap != null) {
    if (pageId.equals(sitemapName)) {
      return createPageBean(sitemapName,sitemap.getLabel(),sitemap.getIcon(),sitemap.getName(),drillDown ? sitemap.getChildren() : null);
    }
 else {
      Widget pageWidget=itemUIRegistry.getWidget(sitemap,pageId);
      if (pageWidget instanceof LinkableWidget) {
        PageBean pageBean=createPageBean(sitemapName,itemUIRegistry.getLabel(pageWidget),itemUIRegistry.getIcon(pageWidget),pageId,drillDown ? (itemUIRegistry.getChildren((LinkableWidget)pageWidget)) : null);
        EObject parentPage=pageWidget.eContainer();
        while (parentPage instanceof Frame) {
          parentPage=parentPage.eContainer();
        }
        if (parentPage instanceof Widget) {
          String parentId=itemUIRegistry.getWidgetId((Widget)pageWidget);
          pageBean.parent=getPageBean(sitemapName,parentId,false);
        }
 else         if (parentPage instanceof Sitemap) {
          pageBean.parent=getPageBean(sitemapName,sitemapName,false);
        }
        return pageBean;
      }
 else {
        if (logger.isDebugEnabled()) {
          if (pageWidget == null) {
            logger.debug("Received HTTP GET request at '{}' for the unknown page id '{}'.",uriInfo.getPath(),pageId);
          }
 else {
            logger.debug("Received HTTP GET request at '{}' for the page id '{}'. " + "This id refers to a non-linkable widget and is therefore no valid page id.",uriInfo.getPath(),pageId);
          }
        }
        throw new WebApplicationException(404);
      }
    }
  }
 else {
    logger.info("Received HTTP GET request at '{}' for the unknown sitemap '{}'.",uriInfo.getPath(),sitemapName);
    throw new WebApplicationException(404);
  }
}
