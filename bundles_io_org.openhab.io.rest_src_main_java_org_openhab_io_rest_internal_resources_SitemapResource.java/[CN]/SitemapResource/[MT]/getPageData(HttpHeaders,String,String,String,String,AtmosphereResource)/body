{
  logger.debug("Received HTTP GET request at '{}' for media type '{}'.",uriInfo.getPath(),type);
  if (TRANSPORT.UNDEFINED.equals(resource.transport())) {
    final String responseType=MediaTypeHelper.getResponseMediaType(headers.getAcceptableMediaTypes(),type);
    if (responseType != null) {
      final PageBean content=getPageBean(sitemapname,pageId,uriInfo.getBaseUriBuilder().build());
      final Object responseObject=ResponseHelper.wrapContentIfNeccessary(callback,responseType,content);
      throw new WebApplicationException(Response.ok(responseObject,responseType).header(ATMOS_TIMEOUT_HEADER,DEFAULT_TIMEOUT_SECS + "").build());
    }
 else {
      throw new WebApplicationException(Response.notAcceptable(null).build());
    }
  }
  BroadcasterFactory broadcasterFactory=resource.getAtmosphereConfig().getBroadcasterFactory();
  GeneralBroadcaster sitemapBroadcaster=broadcasterFactory.lookup(GeneralBroadcaster.class,resource.getRequest().getPathInfo(),true);
  sitemapBroadcaster.addStateChangeListener(new SitemapStateChangeListener());
  boolean resume=false;
  try {
    AtmosphereRequest request=resource.getRequest();
    resume=!ResponseTypeHelper.isStreamingTransport(request);
  }
 catch (  Exception e) {
    logger.debug(e.getMessage(),e);
  }
  return new SuspendResponse.SuspendResponseBuilder<Response>().scope(SCOPE.REQUEST).resumeOnBroadcast(resume).broadcaster(sitemapBroadcaster).period(DEFAULT_TIMEOUT_SECS,TimeUnit.SECONDS).outputComments(true).build();
}
