{
  ArrayList<Configuration> configurations=new ArrayList<Configuration>();
  ArrayList<Device> devices=new ArrayList<Device>();
  Socket socket=null;
  BufferedReader reader=null;
  try {
    String raw=null;
    socket=new Socket(ip,port);
    reader=new BufferedReader(new InputStreamReader(socket.getInputStream()));
    boolean cont=true;
    while (cont) {
      raw=reader.readLine();
      if (raw == null) {
        cont=false;
        continue;
      }
      Message message;
      try {
        message=processRawMessage(raw);
        logger.debug(message.debug());
        if (message != null) {
          if (message.getType() == MessageType.C) {
            configurations.add(Configuration.create(message));
          }
 else           if (message.getType() == MessageType.L) {
            devices.addAll(((L_Message)message).getDevices(configurations));
            logger.debug("MAX!Cube binding: " + devices.size() + " devices found.");
            cont=false;
          }
        }
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
    socket.close();
  }
 catch (  UnknownHostException e) {
    e.printStackTrace();
  }
catch (  IOException e) {
    e.printStackTrace();
  }
}
