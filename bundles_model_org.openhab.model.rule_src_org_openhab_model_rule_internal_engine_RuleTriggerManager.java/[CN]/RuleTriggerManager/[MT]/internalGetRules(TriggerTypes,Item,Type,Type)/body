{
  List<Rule> result=Lists.newArrayList();
  Iterable<Rule> rules=getAllRules(triggerType,item.getName());
  if (rules == null) {
    rules=Lists.newArrayList();
  }
switch (triggerType) {
case STARTUP:
    return systemStartupTriggeredRules;
case SHUTDOWN:
  return systemShutdownTriggeredRules;
case UPDATE:
if (newType instanceof State) {
  State state=(State)newType;
  for (  Rule rule : rules) {
    for (    EventTrigger t : rule.getEventtrigger()) {
      if (t instanceof UpdateEventTrigger) {
        UpdateEventTrigger ut=(UpdateEventTrigger)t;
        if (ut.getItem().equals(item.getName())) {
          if (ut.getState() != null) {
            State triggerState=TypeParser.parseState(item.getAcceptedDataTypes(),ut.getState());
            if (!state.equals(triggerState)) {
              continue;
            }
          }
          result.add(rule);
        }
      }
    }
  }
}
break;
case CHANGE:
if (newType instanceof State && oldType instanceof State) {
State newState=(State)newType;
State oldState=(State)oldType;
for (Rule rule : rules) {
for (EventTrigger t : rule.getEventtrigger()) {
  if (t instanceof ChangedEventTrigger) {
    ChangedEventTrigger ct=(ChangedEventTrigger)t;
    if (ct.getItem().equals(item.getName())) {
      if (ct.getOldState() != null) {
        State triggerOldState=TypeParser.parseState(item.getAcceptedDataTypes(),ct.getOldState());
        if (!oldState.equals(triggerOldState)) {
          continue;
        }
      }
      if (ct.getNewState() != null) {
        State triggerNewState=TypeParser.parseState(item.getAcceptedDataTypes(),ct.getNewState());
        if (!newState.equals(triggerNewState)) {
          continue;
        }
      }
      result.add(rule);
    }
  }
}
}
}
break;
case COMMAND:
if (newType instanceof Command) {
Command command=(Command)newType;
for (Rule rule : rules) {
for (EventTrigger t : rule.getEventtrigger()) {
if (t instanceof CommandEventTrigger) {
CommandEventTrigger ct=(CommandEventTrigger)t;
Command triggerCommand=TypeParser.parseCommand(item.getAcceptedCommandTypes(),ct.getCommand());
if (ct.getItem().equals(item.getName()) && (triggerCommand == null || command.equals(triggerCommand))) {
  result.add(rule);
}
}
}
}
}
break;
}
return result;
}
