{
  Collection<FactHandle> handles=ksession.getFactHandles(new ObjectFilter(){
    public boolean accept(    Object obj){
      if (obj instanceof RuleEvent) {
        return true;
      }
      return false;
    }
  }
);
  for (  FactHandle handle : handles) {
    ksession.retract(handle);
  }
  ArrayList<RuleEvent> clonedQueue=new ArrayList<RuleEvent>(eventQueue);
  eventQueue.clear();
  for (  RuleEvent event : clonedQueue) {
    Item item=event.getItem();
    if (ksession != null && item != null) {
      if (event instanceof StateEvent) {
        FactHandle factHandle=factHandleMap.get(item.getName());
        if (factHandle != null) {
          ksession.update(factHandle,item);
        }
        ksession.insert(event);
      }
    }
  }
  ksession.fireAllRules();
}
