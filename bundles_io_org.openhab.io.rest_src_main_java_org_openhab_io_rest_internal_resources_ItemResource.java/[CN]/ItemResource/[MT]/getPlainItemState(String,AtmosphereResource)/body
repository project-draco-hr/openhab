{
  if (TRANSPORT.UNDEFINED.equals(resource.transport())) {
    Item item=getItem(itemname);
    if (item != null) {
      if (logger.isDebugEnabled())       logger.debug("Received HTTP GET request at '{}'.",uriInfo.getPath());
      throw new WebApplicationException(Response.ok(item.getState().toString()).build());
    }
 else {
      if (logger.isDebugEnabled())       logger.info("Received HTTP GET request at '{}' for the unknown item '{}'.",uriInfo.getPath(),itemname);
      throw new WebApplicationException(404);
    }
  }
  BroadcasterFactory broadcasterFactory=resource.getAtmosphereConfig().getBroadcasterFactory();
  GeneralBroadcaster itemBroadcaster=(GeneralBroadcaster)broadcasterFactory.lookup(GeneralBroadcaster.class,resource.getRequest().getPathInfo(),true);
  itemBroadcaster.addStateChangeListener(new ItemStateChangeListener());
  return new SuspendResponse.SuspendResponseBuilder<String>().scope(SCOPE.REQUEST).resumeOnBroadcast(!ResponseTypeHelper.isStreamingTransport(resource.getRequest())).broadcaster(itemBroadcaster).outputComments(true).build();
}
