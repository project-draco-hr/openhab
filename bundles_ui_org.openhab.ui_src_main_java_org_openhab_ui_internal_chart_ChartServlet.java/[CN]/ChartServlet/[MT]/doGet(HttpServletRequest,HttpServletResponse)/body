{
  logger.debug("Received incoming chart request: ",req);
  int width=defaultWidth;
  try {
    String w=req.getParameter("w");
    if (w != null) {
      Double d=Double.parseDouble(w) * scale;
      width=d.intValue();
    }
  }
 catch (  Exception e) {
  }
  int height=defaultHeight;
  try {
    String h=req.getParameter("h");
    if (h != null) {
      Double d=Double.parseDouble(h) * scale;
      height=d.intValue();
    }
  }
 catch (  Exception e) {
  }
  Long period=PERIODS.get(req.getParameter("period"));
  if (period == null) {
    period=PERIODS.get("D");
  }
  Date timeEnd=new Date();
  Date timeBegin=new Date(timeEnd.getTime() - period);
  String serviceName=req.getParameter("service");
  ChartProvider provider=getChartProviders().get(providerName);
  if (provider == null)   throw new ServletException("Could not get chart provider.");
  res.setContentType("image/" + provider.getChartType());
  try {
    BufferedImage chart=provider.createChart(serviceName,null,timeBegin,timeEnd,height,width,req.getParameter("items"),req.getParameter("groups"));
    ImageIO.write(chart,provider.getChartType().toString(),res.getOutputStream());
  }
 catch (  ItemNotFoundException e) {
    logger.debug("Item not found error while generating chart.");
  }
catch (  IllegalArgumentException e) {
    logger.debug("Illegal argument in chart: {}",e);
  }
}
