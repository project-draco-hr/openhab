{
  if (xpathExpression == null || source == null) {
    throw new TransformationException("the given parameters 'xpath' and 'source' must not be null");
  }
  logger.debug("about to transform '{}' by the function '{}'",source,xpathExpression);
  StringReader stringReader=null;
  try {
    DocumentBuilderFactory domFactory=DocumentBuilderFactory.newInstance();
    domFactory.setNamespaceAware(true);
    domFactory.setValidating(false);
    DocumentBuilder builder=domFactory.newDocumentBuilder();
    stringReader=new StringReader(source);
    InputSource inputSource=new InputSource(stringReader);
    inputSource.setEncoding("UTF-8");
    Document doc=builder.parse(inputSource);
    XPath xpath=XPathFactory.newInstance().newXPath();
    XPathExpression expr=xpath.compile(xpathExpression);
    String transformationResult=(String)expr.evaluate(doc,XPathConstants.STRING);
    logger.debug("transformation resulted in '{}'",transformationResult);
    return transformationResult;
  }
 catch (  Exception e) {
    throw new TransformationException("transformation throws exceptions",e);
  }
 finally {
    if (stringReader != null) {
      stringReader.close();
    }
  }
}
