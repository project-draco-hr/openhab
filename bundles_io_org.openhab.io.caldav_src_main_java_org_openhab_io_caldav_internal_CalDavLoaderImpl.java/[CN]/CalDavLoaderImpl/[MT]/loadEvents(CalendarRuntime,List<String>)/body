{
  CalDavConfig config=calendarRuntime.getConfig();
  Sardine sardine=Util.getConnection(config);
  List<DavResource> list=sardine.list(config.getUrl(),1,false);
  for (  DavResource resource : list) {
    if (resource.isDirectory()) {
      continue;
    }
    final String filename=Util.getFilename(resource.getName());
    oldEventIds.remove(filename);
    EventContainer eventContainer=calendarRuntime.getEventContainerByFilename(filename);
    final org.joda.time.DateTime lastResourceChange=new org.joda.time.DateTime(resource.getModified());
    log.trace("eventContainer found: {}",eventContainer != null);
    log.trace("last resource modification: {}",lastResourceChange);
    log.trace("last change of already loaded event: {}",eventContainer != null ? eventContainer.getLastChanged() : null);
    if (eventContainer != null && !lastResourceChange.isAfter(eventContainer.getLastChanged())) {
      if (eventContainer.getCalculatedUntil().isAfter(org.joda.time.DateTime.now().plusMinutes(config.getReloadMinutes()))) {
        log.trace("skipping resource {}, not changed",resource.getName());
        continue;
      }
      if (eventContainer.isHistoricEvent()) {
        log.trace("skipping resource {}, not changed",resource.getName());
        continue;
      }
      File icsFile=Util.getCacheFile(config.getKey(),filename);
      if (icsFile != null && icsFile.exists()) {
        FileInputStream fis=new FileInputStream(icsFile);
        this.loadEvents(filename,lastResourceChange,fis,config,oldEventIds,false);
        fis.close();
        continue;
      }
    }
    log.debug("loading resource: {}",resource);
    URL url=new URL(config.getUrl());
    url=new URL(url.getProtocol(),url.getHost(),url.getPort(),resource.getPath());
    InputStream inputStream=sardine.get(url.toString().replaceAll(" ","%20"));
    try {
      this.loadEvents(filename,lastResourceChange,inputStream,config,oldEventIds,false);
    }
 catch (    ParserException e) {
      log.error("cannot load calendar entry: " + filename,e);
    }
  }
}
