{
  JobDataMap dataMap=context.getJobDetail().getJobDataMap();
  theStick=(Stick)dataMap.get("Stick");
  if (theStick.isInitialised()) {
    logger.debug("ProcessMessageJob: Locking the queues");
    theStick.queueLock.lock();
    logger.debug("ProcessMessageJob: there are {} msg in the receivedQ",theStick.receivedQueue.size());
    Message message=theStick.receivedQueue.poll();
    logger.debug("ProcessMessageJob: Unlocking the queues");
    theStick.queueLock.unlock();
    if (message != null) {
      PlugwiseDevice target=theStick.getDeviceByMAC(message.getMAC());
      boolean result=false;
      if (target != null) {
        result=target.processMessage(message);
      }
 else {
        result=theStick.processMessage(message);
      }
      if (result) {
        Iterator<Message> messageIterator=theStick.sentQueue.iterator();
        while (messageIterator.hasNext()) {
          Message aMessage=messageIterator.next();
          if (aMessage.getSequenceNumber() == message.getSequenceNumber()) {
            logger.debug("execute: removing a msg from the senTq: {}",aMessage.toString());
            theStick.sentQueue.remove(aMessage);
            break;
          }
        }
      }
    }
  }
}
