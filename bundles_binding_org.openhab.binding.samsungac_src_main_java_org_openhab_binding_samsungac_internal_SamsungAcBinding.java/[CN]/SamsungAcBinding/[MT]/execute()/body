{
  if (!bindingsExist()) {
    logger.debug("There is no existing Samsung AC binding configuration => refresh cycle aborted!");
    return;
  }
  if (nameHostMapper == null) {
    logger.debug("Name host mapper not yet set. Aborted refresh");
    return;
  }
  for (  Map.Entry<String,AirConditioner> entry : nameHostMapper.entrySet()) {
    AirConditioner host=entry.getValue();
    if (host.isConnected()) {
      Map<CommandEnum,String> status=new HashMap<CommandEnum,String>();
      try {
        status=host.getStatus();
      }
 catch (      Exception e) {
        logger.debug("Could not get status.. returning..");
        return;
      }
      for (      CommandEnum cmd : status.keySet()) {
        String item=getItemName(cmd);
        String value=status.get(cmd);
        if (item != null && value != null) {
switch (cmd) {
case AC_FUN_TEMPNOW:
case AC_FUN_TEMPSET:
            postUpdate(item,DecimalType.valueOf(value));
          break;
case AC_FUN_POWER:
        postUpdate(item,value.toUpperCase().equals("ON") ? OnOffType.ON : OnOffType.OFF);
      break;
case AC_FUN_COMODE:
    postUpdate(item,DecimalType.valueOf(Integer.toString(ConvenientModeEnum.valueOf(value).value)));
  break;
case AC_FUN_OPMODE:
postUpdate(item,DecimalType.valueOf(Integer.toString(OperationModeEnum.valueOf(value).value)));
break;
case AC_FUN_WINDLEVEL:
postUpdate(item,DecimalType.valueOf(Integer.toString(DirectionEnum.valueOf(value).value)));
break;
case AC_FUN_DIRECTION:
postUpdate(item,DecimalType.valueOf(Integer.toString(DirectionEnum.valueOf(value).value)));
break;
default :
logger.debug("Not implementation for updating: '" + cmd + "'");
break;
}
}
}
}
 else {
logger.debug("Broken connection found for '{}', attempting to reconnect...",entry.getKey());
try {
host.login();
}
 catch (Exception e) {
logger.debug("Reconnect failed for '{}', will retry in {}s",entry.getKey(),refreshInterval / 1000);
logger.debug("Trying to discover the AC");
Map<String,String> discovered=SsdpDiscovery.discover();
if (discovered != null && discovered.size() > 0) {
logger.warn("Samsung Air Conditioner has been configured, and we found one with IP:'" + discovered.get("IP") + "' and MAC ADDRESS: '"+ discovered.get("MAC_ADDR")+ "'");
}
}
}
}
}
