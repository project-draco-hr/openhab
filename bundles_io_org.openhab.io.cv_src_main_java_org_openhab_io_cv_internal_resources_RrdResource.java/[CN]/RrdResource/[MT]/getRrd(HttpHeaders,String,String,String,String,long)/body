{
  if (logger.isDebugEnabled())   logger.debug("Received GET request at '{}' for rrd '{}'.",uriInfo.getPath(),itemName);
  String responseType=MediaTypeHelper.getResponseMediaType(headers.getAcceptableMediaTypes());
  if (responseType != null) {
    ConsolFun consilidationFunction=ConsolFun.valueOf(consFunction);
    long[] times=Util.getTimestamps(start,end);
    Date startTime=new Date();
    startTime.setTime(times[0] * 1000L);
    Date endTime=new Date();
    endTime.setTime(times[1] * 1000L);
    if (itemName.endsWith(".rrd"))     itemName=itemName.substring(0,itemName.length() - 4);
    String[] parts=itemName.split(":");
    String service="rrd4j";
    if (parts.length == 2) {
      itemName=parts[1];
      service=parts[0];
    }
    Item item;
    try {
      item=CVApplication.getItemUIRegistry().getItem(itemName);
      logger.debug("item '{}' found ",item);
      QueryablePersistenceService persistenceService=CVApplication.getPersistenceServices().get(service);
      if (persistenceService == null) {
        Iterator<Entry<String,QueryablePersistenceService>> pit=CVApplication.getPersistenceServices().entrySet().iterator();
        if (pit.hasNext()) {
          persistenceService=pit.next().getValue();
        }
 else {
          throw new IllegalArgumentException("No Persistence service found.");
        }
      }
      Object data=null;
      if (persistenceService.getName().equals("rrd4j")) {
        data=getRrdSeries(persistenceService,item,consilidationFunction,startTime,endTime,resolution);
      }
 else {
        data=getPersistenceSeries(persistenceService,item,startTime,endTime,resolution);
      }
      return Response.ok(data,responseType).build();
    }
 catch (    ItemNotFoundException e) {
      logger.error("Item '{}' not found error while requesting series data.",itemName);
    }
    return Response.serverError().build();
  }
 else {
    return Response.notAcceptable(null).build();
  }
}
