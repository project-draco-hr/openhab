{
  while (!interrupted) {
    while (ip == null) {
      try {
        sleep(1000L);
      }
 catch (      InterruptedException e) {
        interrupted=true;
        break;
      }
    }
    if (ip != null) {
      BufferedReader reader=null;
      try {
        connection=new Socket(ip,MONITOR_PORT);
        reader=new BufferedReader(new InputStreamReader(connection.getInputStream()));
        waitBeforeRetry=60000L;
      }
 catch (      Exception e) {
        logger.error("Could not connect to FritzBox on " + ip + ":"+ MONITOR_PORT,e);
        logger.info("Retrying connection to FritzBox in " + waitBeforeRetry / 1000L + "s");
        try {
          Thread.sleep(waitBeforeRetry);
        }
 catch (        InterruptedException ex) {
          interrupted=true;
        }
        waitBeforeRetry+=60000L;
      }
      if (reader != null) {
        logger.info("Connected to FritzBox on " + ip + ":"+ MONITOR_PORT);
        while (!interrupted) {
          try {
            String line=reader.readLine();
            if (line != null) {
              MonitorEvent event=parseMonitorEvent(line);
              processMonitorEvent(event);
              try {
                sleep(100L);
              }
 catch (              InterruptedException e) {
              }
            }
          }
 catch (          IOException e) {
            logger.warn("Lost connection to FritzBox on " + ip + ":"+ MONITOR_PORT,e);
            break;
          }
        }
      }
    }
  }
}
