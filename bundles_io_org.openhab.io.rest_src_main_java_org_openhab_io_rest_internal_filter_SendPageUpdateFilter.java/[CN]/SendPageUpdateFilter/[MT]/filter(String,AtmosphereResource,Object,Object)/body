{
  final HttpServletRequest request=resource.getRequest();
  try {
    if (ResponseTypeHelper.isStreamingTransport(request)) {
      if (message instanceof PageBean && originalMessage instanceof Item) {
        final String delayedBroadcasterName=resource.getRequest().getPathInfo();
        if (isPageUpdated(request,message)) {
          Executors.newSingleThreadExecutor().submit(new Runnable(){
            public void run(){
              try {
                Thread.sleep(300);
                BroadcasterFactory broadcasterFactory=resource.getAtmosphereConfig().getBroadcasterFactory();
                GeneralBroadcaster delayedBroadcaster=broadcasterFactory.lookup(GeneralBroadcaster.class,delayedBroadcasterName);
                delayedBroadcaster.broadcast(message,resource);
              }
 catch (              Exception e) {
                logger.error("Could not broadcast messages",e);
              }
            }
          }
);
        }
      }
      if (originalMessage instanceof PageBean) {
        final PageBean responseBean=clonePageBeanWithoutWidgets((PageBean)message);
        return new BroadcastAction(ACTION.CONTINUE,responseBean);
      }
    }
    return new BroadcastAction(ACTION.CONTINUE,message);
  }
 catch (  Exception e) {
    logger.error(e.getMessage(),e);
    return new BroadcastAction(ACTION.ABORT,message);
  }
}
