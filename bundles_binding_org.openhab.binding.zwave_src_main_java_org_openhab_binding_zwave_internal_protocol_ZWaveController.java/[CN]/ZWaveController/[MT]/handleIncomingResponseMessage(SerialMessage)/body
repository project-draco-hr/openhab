{
  logger.trace("Message type = RESPONSE");
  ZWaveCommandProcessor processor=ZWaveCommandProcessor.getMessageDispatcher(incomingMessage.getMessageClass());
  if (processor != null) {
    processor.handleResponse(this,lastSentMessage,incomingMessage);
    if (processor.isTransactionComplete()) {
      notifyEventListeners(new ZWaveTransactionCompletedEvent(this.lastSentMessage));
      transactionCompleted.release();
      logger.trace("Released. Transaction completed permit count -> {}",transactionCompleted.availablePermits());
    }
  }
 else {
    logger.warn(String.format("TODO: Implement processing of Response Message = %s (0x%02X)",incomingMessage.getMessageClass().getLabel(),incomingMessage.getMessageClass().getKey()));
  }
switch (incomingMessage.getMessageClass()) {
case GetVersion:
    this.zWaveVersion=((GetVersionMessageClass)processor).getVersion();
  this.ZWaveLibraryType=((GetVersionMessageClass)processor).getLibraryType();
break;
case MemoryGetId:
this.ownNodeId=((MemoryGetIdMessageClass)processor).getNodeId();
this.homeId=((MemoryGetIdMessageClass)processor).getHomeId();
break;
case SerialApiGetInitData:
this.isConnected=true;
for (Integer nodeId : ((SerialApiGetInitDataMessageClass)processor).getNodes()) {
ZWaveNodeSerializer nodeSerializer=new ZWaveNodeSerializer();
ZWaveNode node=nodeSerializer.DeserializeNode(nodeId);
String name=node.getName();
String location=node.getLocation();
if (node != null) {
if (node.getManufacturer() == Integer.MAX_VALUE || node.getHomeId() != this.homeId || node.getNodeId() != nodeId) {
logger.warn("NODE {}: Config file data is invalid, ignoring config.",nodeId);
node=null;
}
 else {
logger.debug("NODE {}: Restored from config.",nodeId);
node.setRestoredFromConfigfile(this);
for (ZWaveCommandClass commandClass : node.getCommandClasses()) {
commandClass.setController(this);
commandClass.setNode(node);
if (commandClass instanceof ZWaveEventListener) {
this.addEventListener((ZWaveEventListener)commandClass);
}
}
}
}
if (node == null) {
node=new ZWaveNode(this.homeId,nodeId,this);
node.setName(name);
node.setLocation(location);
}
if (nodeId == this.ownNodeId) {
node.setDeviceId(this.getDeviceId());
node.setDeviceType(this.getDeviceType());
node.setManufacturer(this.getManufactureId());
}
this.zwaveNodes.put(nodeId,node);
node.advanceNodeStage(NodeStage.PROTOINFO);
}
break;
case GetSucNodeId:
this.sucID=((GetSucNodeIdMessageClass)processor).getSucNodeId();
if (this.setSUC == true && this.sucID == 0) {
this.enqueue(new EnableSucMessageClass().doRequest(EnableSucMessageClass.SUCType.SERVER));
this.enqueue(new SetSucNodeMessageClass().doRequest(this.ownNodeId,SetSucNodeMessageClass.SUCType.SERVER));
}
 else if (this.setSUC == false && this.sucID == this.ownNodeId) {
this.enqueue(new EnableSucMessageClass().doRequest(EnableSucMessageClass.SUCType.NONE));
this.enqueue(new SetSucNodeMessageClass().doRequest(this.ownNodeId,SetSucNodeMessageClass.SUCType.NONE));
}
this.enqueue(new GetControllerCapabilitiesMessageClass().doRequest());
break;
case SerialApiGetCapabilities:
this.serialAPIVersion=((SerialApiGetCapabilitiesMessageClass)processor).getSerialAPIVersion();
this.manufactureId=((SerialApiGetCapabilitiesMessageClass)processor).getManufactureId();
this.deviceId=((SerialApiGetCapabilitiesMessageClass)processor).getDeviceId();
this.deviceType=((SerialApiGetCapabilitiesMessageClass)processor).getDeviceType();
this.enqueue(new SerialApiGetInitDataMessageClass().doRequest());
break;
case GetControllerCapabilities:
this.controllerType=((GetControllerCapabilitiesMessageClass)processor).getDeviceType();
break;
default :
break;
}
}
