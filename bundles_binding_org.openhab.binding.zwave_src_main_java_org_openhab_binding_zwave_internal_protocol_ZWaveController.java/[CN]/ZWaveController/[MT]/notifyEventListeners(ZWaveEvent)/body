{
  logger.debug("Notifying event listeners");
  ArrayList<ZWaveEventListener> copy=new ArrayList<ZWaveEventListener>(this.zwaveEventListeners);
  for (  ZWaveEventListener listener : copy) {
    logger.trace("Notifying {}",listener.toString());
    listener.ZWaveIncomingEvent(event);
  }
  if (event instanceof ZWaveInclusionEvent) {
    ZWaveInclusionEvent incEvent=(ZWaveInclusionEvent)event;
switch (incEvent.getEvent()) {
case IncludeDone:
      logger.debug("NODE {}: Including node.",incEvent.getNodeId());
    if (getNode(incEvent.getNodeId()) != null) {
      logger.debug("NODE {}: Newly included node already exists - not initialising.",incEvent.getNodeId());
      break;
    }
  ZWaveNode node=new ZWaveNode(this.homeId,incEvent.getNodeId(),this);
this.zwaveNodes.put(incEvent.getNodeId(),node);
node.advanceNodeStage(NodeStage.PROTOINFO);
break;
case ExcludeDone:
logger.debug("NODE {}: Excluding node.",incEvent.getNodeId());
if (getNode(incEvent.getNodeId()) == null) {
logger.debug("NODE {}: Excluding node that doesn't exist.",incEvent.getNodeId());
break;
}
this.zwaveNodes.remove(incEvent.getNodeId());
ZWaveNodeSerializer nodeSerializer=new ZWaveNodeSerializer();
nodeSerializer.DeleteNode(event.getNodeId());
break;
default :
break;
}
}
if (event instanceof ZWaveNetworkEvent) {
ZWaveNetworkEvent networkEvent=(ZWaveNetworkEvent)event;
switch (networkEvent.getEvent()) {
case FailedNode:
if (getNode(networkEvent.getNodeId()) == null) {
logger.debug("NODE {}: Deleting a node that doesn't exist.",networkEvent.getNodeId());
break;
}
if (networkEvent.getState() == State.Success) {
logger.debug("NODE {}: Marking node as failed because its on the controllers failed node list.",networkEvent.getNodeId());
getNode(networkEvent.getNodeId()).setNodeStage(NodeStage.FAILED);
ZWaveEvent zEvent=new ZWaveNodeStatusEvent(networkEvent.getNodeId(),ZWaveNodeStatusEvent.State.Failed);
this.notifyEventListeners(zEvent);
break;
}
case DeleteNode:
if (getNode(networkEvent.getNodeId()) == null) {
logger.debug("NODE {}: Deleting a node that doesn't exist.",networkEvent.getNodeId());
break;
}
this.zwaveNodes.remove(networkEvent.getNodeId());
ZWaveNodeSerializer nodeSerializer=new ZWaveNodeSerializer();
nodeSerializer.DeleteNode(event.getNodeId());
break;
default :
break;
}
}
}
