{
  List<Object> result=new ArrayList<Object>();
  ItemStateListBean response=new ItemStateListBean(new ItemListBean());
  for (  Object cacheMessage : super.retrieveFromCache(broadcasterId,r)) {
    if (cacheMessage instanceof ItemStateListBean) {
      ItemStateListBean cachedStateList=(ItemStateListBean)cacheMessage;
      response.stateList.entries.addAll(cachedStateList.stateList.entries);
      if (response.index < cachedStateList.index) {
        response.index=cachedStateList.index;
      }
    }
 else     if (cacheMessage instanceof Item) {
      Item item=(Item)cacheMessage;
      response.stateList.entries.add(new JAXBElement(new QName(item.getName()),String.class,item.getState().toString()));
    }
  }
  if (response.stateList.entries.size() > 0) {
    if (response.index == 0) {
      response.index=System.currentTimeMillis();
    }
    result.add(response);
  }
  logger.info("Retrieved for AtmosphereResource {} cached messages {}",r.uuid(),result);
  return result;
}
