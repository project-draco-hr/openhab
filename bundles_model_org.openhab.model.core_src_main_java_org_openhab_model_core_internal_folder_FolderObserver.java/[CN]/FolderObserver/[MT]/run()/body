{
  while (!folderRefreshMap.isEmpty()) {
    try {
      for (      String foldername : folderRefreshMap.keySet()) {
        if (lastFileNames.get(foldername) != null && (refreshCount % folderRefreshMap.get(foldername) > 0)) {
          logger.debug("skipping refresh of folder '{}' folderRefreshMap={}",foldername,folderRefreshMap.get(foldername));
          continue;
        }
        logger.debug("Refreshing folder '{}'",foldername);
        checkFolder(foldername);
      }
      refreshCount=(refreshCount + gcdRefresh) % lcmRefresh;
    }
 catch (    Throwable e) {
      logger.error("An unexpected exception has occured",e);
    }
    try {
      if (gcdRefresh <= 0)       break;
synchronized (this) {
        wait(gcdRefresh * 1000L);
      }
    }
 catch (    InterruptedException e) {
      break;
    }
  }
}
