{
  while (stateUpdater == this) {
    InsteonHubProxyUpdate update=null;
    try {
      update=updateQueue.take();
    }
 catch (    InterruptedException e) {
    }
    if (update == null) {
      continue;
    }
    if (logger.isDebugEnabled()) {
      logger.debug(getConnectionString() + " - Processing: " + update);
    }
    if (update.device != null) {
      try {
        if (update.type == UpdateType.ANALOG_SET) {
          setLevel(update.device,update.level,true);
          if (listener != null) {
            listener.onAnalogUpdate(update.device,update.level);
          }
        }
 else         if (update.type == UpdateType.DIGITAL_SET) {
          setLevel(update.device,update.level,false);
          if (listener != null) {
            listener.onDigitalUpdate(update.device,update.level > 0);
          }
        }
 else         if (update.type == UpdateType.ANALOG_ADJUST) {
          int curLevel=getLevel(update.device);
          int adj=analogAdjustments.get(update.device).getAndSet(0);
          int newLevel=curLevel + adj;
          setLevel(update.device,newLevel);
          if (listener != null) {
            listener.onAnalogUpdate(update.device,newLevel);
          }
        }
      }
 catch (      Throwable t) {
        InsteonHubBindingLogUtil.warnCommunicationFailure(logger,InsteonHubProxy.this,update.device,t);
      }
    }
  }
}
