{
  Iterable<HistoricItem> result=getAllStatesSince(item,timestamp,serviceName);
  Iterator<HistoricItem> it=result.iterator();
  DecimalType average=averageSince(item,timestamp,serviceName);
  if (average == null) {
    return null;
  }
  double total=0;
  int quantity=0;
  DecimalType histValue=null;
  while (it.hasNext()) {
    State state=it.next().getState();
    if (state instanceof DecimalType) {
      histValue=(DecimalType)state;
      total+=Math.pow(histValue.doubleValue() - average.doubleValue(),2);
      quantity++;
    }
  }
  DecimalType currentValue=(DecimalType)item.getStateAs(DecimalType.class);
  if (currentValue != null && currentValue != histValue) {
    total+=Math.pow(currentValue.doubleValue() - average.doubleValue(),2);
    quantity++;
  }
  if (quantity == 0) {
    return null;
  }
 else {
    double variance=total / quantity;
    return new DecimalType(variance);
  }
}
