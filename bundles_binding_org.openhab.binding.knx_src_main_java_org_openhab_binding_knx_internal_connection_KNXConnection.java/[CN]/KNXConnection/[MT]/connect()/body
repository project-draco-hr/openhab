{
  shutdown=false;
  try {
    if (StringUtils.isNotBlank(ip)) {
      link=connectByIp(ipConnectionType,localIp,ip,port);
    }
 else     if (StringUtils.isNotBlank(serialPort)) {
      link=connectBySerial(serialPort);
    }
 else {
      logger.error("No IP address or serial port could be found in configuration!");
      return;
    }
    NetworkLinkListener linkListener=new NetworkLinkListener(){
      public void linkClosed(      CloseEvent e){
        if (!e.isUserRequest() && !shutdown) {
          logger.warn("KNX link has been lost (reason: {} on object {}) - reconnecting...",e.getReason(),e.getSource().toString());
          connect();
        }
        if (!link.isOpen() && !shutdown) {
          logger.error("KNX link has been lost!");
          if (autoReconnectPeriod > 0) {
            logger.info("KNX link will be retried in " + autoReconnectPeriod + " seconds");
            final Timer timer=new Timer();
            TimerTask timerTask=new TimerTask(){
              @Override public void run(){
                if (shutdown) {
                  timer.cancel();
                }
 else {
                  logger.info("..retrying Knx connection");
                  connect();
                  if (link.isOpen()) {
                    timer.cancel();
                  }
                }
              }
            }
;
            timer.schedule(timerTask,autoReconnectPeriod * 1000,autoReconnectPeriod * 1000);
          }
        }
      }
      public void indication(      FrameEvent e){
      }
      public void confirmation(      FrameEvent e){
      }
    }
;
    link.addLinkListener(linkListener);
    if (pc != null) {
      pc.removeProcessListener(listener);
      pc.detach();
    }
    pc=new ProcessCommunicatorImpl(link);
    pc.setResponseTimeout((int)responseTimeout / 1000);
    if (listener != null) {
      pc.addProcessListener(listener);
    }
    if (KNXConnection.connectionEstablishedListener != null) {
      KNXConnection.connectionEstablishedListener.connectionEstablished();
    }
    if (logger.isInfoEnabled()) {
      if (link instanceof KNXNetworkLinkIP) {
        String ipConnectionTypeString=KNXConnection.ipConnectionType == KNXNetworkLinkIP.ROUTER ? "ROUTER" : "TUNNEL";
        logger.info("Established connection to KNX bus on {} in mode {}.",ip + ":" + port,ipConnectionTypeString);
      }
 else {
        logger.info("Established connection to KNX bus through FT1.2 on serial port {}.",serialPort);
      }
    }
  }
 catch (  KNXException e) {
    logger.error("Error connecting to KNX bus: {}",e.getMessage());
  }
catch (  UnknownHostException e) {
    logger.error("Error connecting to KNX bus: {}",e.getMessage());
  }
}
