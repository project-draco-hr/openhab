{
  DSCAlarmEvent dscAlarmEvent=(DSCAlarmEvent)event;
  APIMessage apiMessage=dscAlarmEvent.getAPIMessage();
  APIMessage.APIMessageType apiMessageType=apiMessage.getAPIMessageType();
  DSCAlarmItemType dscAlarmItemType=null;
  APICode apiCode=APICode.getAPICodeValue(apiMessage.getAPICode());
  String apiData=apiMessage.getAPIData();
  DSCAlarmBindingConfig config=null;
  Item item=null;
  String itemName="";
  int forLimit=1;
  boolean found=false;
  int state=0;
switch (apiCode) {
case CommandAcknowledge:
    dscAlarmItemUpdate.setConnected(true);
  if (apiData.equals("000")) {
    dscAlarmItemType=DSCAlarmItemType.PANEL_CONNECTION;
  }
break;
case SystemError:
dscAlarmItemType=DSCAlarmItemType.PANEL_SYSTEM_ERROR;
break;
case KeypadLEDState:
case KeypadLEDFlashState:
keypadLEDStateEventHandler(event);
break;
case TimeDateBroadcast:
dscAlarmItemType=DSCAlarmItemType.PANEL_TIME_DATE;
break;
case PartitionReady:
case PartitionNotReady:
case PartitionReadyForceArming:
case FailureToArm:
case SystemArmingInProgress:
dscAlarmItemType=DSCAlarmItemType.PARTITION_STATUS;
break;
case PartitionArmed:
forLimit=2;
updateItemType(DSCAlarmItemType.PARTITION_ARMED,apiMessage.getPartition(),-1,1);
updateItemType(DSCAlarmItemType.PARTITION_ENTRY_DELAY,apiMessage.getPartition(),-1,0);
updateItemType(DSCAlarmItemType.PARTITION_EXIT_DELAY,apiMessage.getPartition(),-1,0);
dscAlarmItemType=DSCAlarmItemType.PARTITION_ARM_MODE;
break;
case PartitionDisarmed:
updateItemType(DSCAlarmItemType.PARTITION_ARMED,apiMessage.getPartition(),-1,0);
updateItemType(DSCAlarmItemType.PARTITION_ENTRY_DELAY,apiMessage.getPartition(),-1,0);
updateItemType(DSCAlarmItemType.PARTITION_EXIT_DELAY,apiMessage.getPartition(),-1,0);
updateItemType(DSCAlarmItemType.PARTITION_IN_ALARM,apiMessage.getPartition(),-1,0);
dscAlarmItemType=DSCAlarmItemType.PARTITION_ARM_MODE;
break;
case PartitionInAlarm:
updateItemType(DSCAlarmItemType.PARTITION_IN_ALARM,apiMessage.getPartition(),-1,1);
dscAlarmItemType=DSCAlarmItemType.PARTITION_STATUS;
break;
case ZoneAlarm:
state=1;
case ZoneAlarmRestore:
updateItemType(DSCAlarmItemType.ZONE_IN_ALARM,apiMessage.getPartition(),apiMessage.getZone(),state);
dscAlarmItemType=DSCAlarmItemType.ZONE_ALARM_STATUS;
break;
case ZoneTamper:
state=1;
case ZoneTamperRestore:
updateItemType(DSCAlarmItemType.ZONE_TAMPER,apiMessage.getPartition(),apiMessage.getZone(),state);
dscAlarmItemType=DSCAlarmItemType.ZONE_TAMPER_STATUS;
break;
case ZoneFault:
state=1;
case ZoneFaultRestore:
updateItemType(DSCAlarmItemType.ZONE_FAULT,apiMessage.getPartition(),apiMessage.getZone(),state);
dscAlarmItemType=DSCAlarmItemType.ZONE_FAULT_STATUS;
break;
case ZoneOpen:
state=1;
case ZoneRestored:
updateItemType(DSCAlarmItemType.ZONE_TRIPPED,apiMessage.getPartition(),apiMessage.getZone(),state);
dscAlarmItemType=DSCAlarmItemType.ZONE_GENERAL_STATUS;
break;
case FireKeyAlarm:
state=1;
case FireKeyRestored:
updateItemType(DSCAlarmItemType.PANEL_FIRE_KEY_ALARM,apiMessage.getPartition(),apiMessage.getZone(),state);
break;
case PanicKeyAlarm:
state=1;
case PanicKeyRestored:
updateItemType(DSCAlarmItemType.PANEL_PANIC_KEY_ALARM,apiMessage.getPartition(),apiMessage.getZone(),state);
break;
case AuxiliaryKeyAlarm:
state=1;
case AuxiliaryKeyRestored:
updateItemType(DSCAlarmItemType.PANEL_AUX_KEY_ALARM,apiMessage.getPartition(),apiMessage.getZone(),state);
break;
case AuxiliaryInputAlarm:
state=1;
case AuxiliaryInputAlarmRestored:
updateItemType(DSCAlarmItemType.PANEL_AUX_INPUT_ALARM,apiMessage.getPartition(),apiMessage.getZone(),state);
break;
case EntryDelayInProgress:
updateItemType(DSCAlarmItemType.PARTITION_ENTRY_DELAY,apiMessage.getPartition(),-1,1);
break;
case ExitDelayInProgress:
updateItemType(DSCAlarmItemType.PARTITION_EXIT_DELAY,apiMessage.getPartition(),-1,1);
break;
case CodeRequired:
api.sendCommand(APICode.CodeSend);
break;
case LEDStatus:
int aData=Integer.parseInt(apiData.substring(0,1));
switch (aData) {
case 1:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_READY_LED;
break;
case 2:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_ARMED_LED;
break;
case 3:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_MEMORY_LED;
break;
case 4:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_BYPASS_LED;
break;
case 5:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_TROUBLE_LED;
break;
case 6:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_PROGRAM_LED;
break;
case 7:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_FIRE_LED;
break;
case 8:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_BACKLIGHT_LED;
break;
case 9:
dscAlarmItemType=DSCAlarmItemType.KEYPAD_AC_LED;
break;
}
default :
break;
}
int partitionId=apiMessage.getPartition();
int zoneId=apiMessage.getZone();
logger.debug("dscAlarmEventRecieved(): Event received! Looking for item: {}",dscAlarmItemType);
for (int i=0; i <= forLimit; i++) {
if (dscAlarmItemType != null) {
for (DSCAlarmBindingProvider prov : providers) {
for (String iName : prov.getItemNames()) {
config=prov.getDSCAlarmBindingConfig(iName);
if (config != null) {
switch (apiMessageType) {
case PANEL_EVENT:
if (dscAlarmItemType == config.getDSCAlarmItemType()) {
itemName=iName;
found=true;
}
break;
case PARTITION_EVENT:
if (partitionId == config.getPartitionId() && dscAlarmItemType == config.getDSCAlarmItemType()) {
itemName=iName;
found=true;
}
break;
case ZONE_EVENT:
if (zoneId == config.getZoneId() && dscAlarmItemType == config.getDSCAlarmItemType()) {
itemName=iName;
found=true;
}
break;
case KEYPAD_EVENT:
if (dscAlarmItemType == config.getDSCAlarmItemType()) {
itemName=iName;
found=true;
}
break;
default :
found=false;
break;
}
}
if (found) {
item=prov.getItem(itemName);
dscAlarmItemUpdate.updateDeviceItem(item,config,eventPublisher,dscAlarmEvent);
pollTimeStart=0;
break;
}
}
if (found) break;
}
}
if (dscAlarmItemType == DSCAlarmItemType.PARTITION_ARM_MODE && apiCode == APICode.PartitionArmed) {
dscAlarmItemType=DSCAlarmItemType.PARTITION_STATUS;
apiMessageType=APIMessage.APIMessageType.PARTITION_EVENT;
found=false;
}
 else {
dscAlarmItemType=DSCAlarmItemType.PANEL_MESSAGE;
apiMessageType=APIMessage.APIMessageType.PANEL_EVENT;
partitionId=0;
zoneId=0;
found=false;
}
}
}
