{
  try {
    String newInStuff=inStuff;
    String newCommandThing=commandThing;
    String newUpdateThing=updateThing;
    String tmp;
    Matcher matcher;
    String iName=null;
    String iVar=null;
    matcher=SERVICE_IN_PATTERN.matcher(newInStuff);
    if (matcher.matches()) {
      iName=matcher.group("serviceName");
      iVar=matcher.group("serviceVar");
      tmp=aliasMap.get(iName);
      if (tmp != null) {
        iName=tmp;
      }
      newInStuff="service/" + iName + '/'+ iVar;
    }
    String uName=null;
    String uAction=null;
    String uParam=null;
    if (newUpdateThing != null && !newUpdateThing.equals("")) {
      matcher=SERVICE_UPDATE_PATTERN.matcher(newUpdateThing);
      if (matcher.matches()) {
        uName=matcher.group("serviceName");
        uAction=matcher.group("serviceAction");
        uParam=matcher.group("serviceParam");
        uParam=(uParam == null) ? "" : uParam;
        if (uName == null) {
          uName=iName;
        }
 else {
          tmp=aliasMap.get(uName);
          if (tmp != null) {
            uName=tmp;
          }
        }
        newUpdateThing=uName + '/' + uAction+ '('+ uParam+ ')';
      }
 else {
        throw new BindingConfigParseException("Binding parameter 'update:' doesn't follow the required pattern");
      }
    }
    String cTransform=null;
    String cParam=null;
    Map<String,String> cMap=null;
    if ("".equals(newCommandThing)) {
      cMap=COMMAND_DEFAULTS;
    }
 else     if (newCommandThing != null) {
      matcher=SERVICE_COMMAND_TRANSFORM_PATTERN.matcher(newCommandThing);
      if (matcher.matches()) {
        cTransform=matcher.group("transformCommand");
        cParam=matcher.group("transformParam");
      }
 else {
        String[] commandList=newCommandThing.split("\\|");
        String command;
        Map<String,String> l=new HashMap<String,String>(commandList.length);
        for (int i=0; i < commandList.length; i++) {
          command=commandList[i];
          matcher=SERVICE_COMMAND_INMAP_PATTERN.matcher(command);
          if (matcher.matches()) {
            String mapName=matcher.group("mapName");
            String mapValue=matcher.group("mapValue");
            String oldMapName=l.put(mapName,mapValue);
            if (oldMapName != null) {
              throw new BindingConfigParseException(String.format("Duplicate inline Map entry '%s' in command: '%s'",oldMapName,newCommandThing));
            }
          }
 else {
            throw new BindingConfigParseException(String.format("Invalid command, parameter format '%s' in command: '%s'",command,newCommandThing));
          }
        }
        cMap=l;
      }
    }
    logger.trace("newInStuff '{}', newUpdateThing '{}', iName '{}', iVar '{}', uName '{}', uAction '{}', uParam '{}'",new Object[]{newInStuff,newUpdateThing,iName,iVar,uName,uAction,uParam});
    DeviceBindingConfig c=new DeviceBindingConfig(context,itemName,unitName,id,newInStuff,itemType,newCommandThing,newUpdateThing,inTransform,outTransform);
    c.initialize();
    c.inServiceName=iName;
    c.inServiceVariable=iVar;
    c.updateServiceName=uName;
    c.updateServiceAction=uAction;
    c.updateServiceParam=uParam;
    c.commandTransformName=cTransform;
    c.commandTransformParam=cParam;
    c.commandMap=cMap;
    return c;
  }
 catch (  Exception e) {
    logger.debug(e.toString());
    throw new BindingConfigParseException(e.getMessage());
  }
}
