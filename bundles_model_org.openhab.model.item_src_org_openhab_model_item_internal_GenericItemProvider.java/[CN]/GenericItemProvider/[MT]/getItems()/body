{
  Map<String,Item> items=new HashMap<String,Item>();
  if (modelRepository != null) {
    for (    String modelName : modelRepository.getAllModelNamesOfType("items")) {
      ItemModel model=(ItemModel)modelRepository.getModel(modelName);
      if (model == null)       continue;
      for (      BindingConfigReader reader : bindingConfigReaders.values()) {
        reader.removeConfigurations(modelName);
      }
      for (      ModelItem modelItem : model.getItems()) {
        Item item=null;
        if (modelItem instanceof ModelGroupItem) {
          ModelGroupItem modelGroupItem=(ModelGroupItem)modelItem;
          String baseItemType=modelGroupItem.getType();
          GenericItem baseItem=getItemOfType(baseItemType,modelGroupItem.getName());
          if (baseItem != null) {
            ModelGroupFunction function=modelGroupItem.getFunction();
            if (function == null) {
              item=new GroupItem(modelGroupItem.getName(),baseItem);
            }
 else {
              List<State> args=new ArrayList<State>();
              for (              String arg : modelGroupItem.getArgs()) {
                State state=TypeParser.parseState(baseItem.getAcceptedDataTypes(),arg);
                if (state == null) {
                  logger.warn("State '" + arg + "' is not valid for group item '"+ modelGroupItem.getName()+ "' with base type '"+ baseItemType+ "'");
                  args.clear();
                  break;
                }
 else {
                  args.add(state);
                }
              }
              GroupFunction groupFunction=null;
switch (function) {
case AND:
                if (args.size() == 2) {
                  groupFunction=new ArithmeticGroupFunction.And(args.get(0),args.get(1));
                  break;
                }
 else {
                  logger.error("Group function 'AND' requires two arguments. Using Equality instead.");
                }
case OR:
              if (args.size() == 2) {
                groupFunction=new ArithmeticGroupFunction.Or(args.get(0),args.get(1));
                break;
              }
 else {
                logger.error("Group function 'OR' requires two arguments. Using Equality instead.");
              }
case AVG:
            groupFunction=new ArithmeticGroupFunction.Avg();
          break;
case MIN:
        groupFunction=new ArithmeticGroupFunction.Min();
      break;
case MAX:
    groupFunction=new ArithmeticGroupFunction.Max();
  break;
default :
logger.error("Unknown group function '" + function.getName() + "'. Using Equality instead.");
}
if (groupFunction == null) {
groupFunction=new GroupFunction.Equality();
}
item=new GroupItem(modelGroupItem.getName(),baseItem,groupFunction);
}
}
 else {
item=new GroupItem(modelGroupItem.getName());
}
if (item != null) {
items.put(modelGroupItem.getName(),item);
}
}
 else {
ModelNormalItem normalItem=(ModelNormalItem)modelItem;
String itemName=normalItem.getName();
item=getItemOfType(normalItem.getType(),itemName);
if (item != null) items.put(itemName,item);
}
if (item != null) {
dispatchBindings(modelName,item,modelItem.getBindings());
}
}
for (ModelItem modelItem : model.getItems()) {
for (ModelGroupItem groupItem : modelItem.getGroups()) {
GroupItem group=(GroupItem)items.get(groupItem.getName());
if (group != null) {
group.addMember(items.get(modelItem.getName()));
}
}
}
}
}
return items.values();
}
