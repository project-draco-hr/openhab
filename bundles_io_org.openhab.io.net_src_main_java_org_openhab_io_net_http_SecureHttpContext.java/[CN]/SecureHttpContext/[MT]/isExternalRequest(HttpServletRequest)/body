{
  long startTime=System.currentTimeMillis();
  String remoteAddr=request.getRemoteAddr();
  try {
    InetAddress remoteIp=InetAddress.getByName(remoteAddr);
    if (remoteIp.isLoopbackAddress()) {
      return false;
    }
    boolean isExternal=!subnetUtils.isInRange(remoteAddr);
    logger.trace("http request is originated by '{}' which is identified as '{}'",remoteAddr,isExternal ? "external" : "internal");
    return isExternal;
  }
 catch (  UnknownHostException uhe) {
    logger.error(uhe.getLocalizedMessage());
  }
catch (  IllegalArgumentException iae) {
    logger.warn("couldn't parse '{}' to a valid ip address",remoteAddr);
  }
 finally {
    logger.debug("checking ip is in range took {}ms",System.currentTimeMillis() - startTime);
  }
  return true;
}
