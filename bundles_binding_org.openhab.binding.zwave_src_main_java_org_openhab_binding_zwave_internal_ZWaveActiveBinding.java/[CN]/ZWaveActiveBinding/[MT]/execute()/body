{
  if (!isZwaveNetworkReady) {
    logger.debug("Zwave Network isn't ready yet!");
    if (this.zController != null)     this.zController.checkForDeadOrSleepingNodes();
    return;
  }
  refreshCount++;
  if (refreshCount > refreshThreshold) {
    logger.trace("Reseting Refresh Count to Zero");
    refreshCount=0;
  }
 else {
    logger.trace(String.format("Refresh Count: %d",refreshCount));
  }
  for (  ZWaveBindingProvider provider : providers) {
    for (    String itemName : provider.getItemNames()) {
      State value=UnDefType.UNDEF;
      int nodeId=provider.getZwaveBindingConfig(itemName).getNodeId();
      int endpoint=provider.getZwaveBindingConfig(itemName).getEndpoint();
      ZWaveBindingAction action=provider.getZwaveBindingConfig(itemName).getAction();
      ZWaveNode zNode=this.zController.getNode(nodeId);
switch (action) {
case RESTORE_LAST_VALUE:
case NONE:
        if (refreshCount == 0)         this.zController.requestValue(zNode.getNodeId(),endpoint);
      continue;
case REPORT_BATTERY_LEVEL:
    if (refreshCount == 0)     this.zController.requestBatteryLevel(zNode.getNodeId(),endpoint);
  continue;
case REPORT_HOMEID:
value=new StringType(String.format("0x%08X",zNode.getHomeId()));
break;
case REPORT_NODEID:
value=new StringType(String.format("%d",zNode.getNodeId()));
break;
case REPORT_MANUFACTURER:
value=new StringType(String.format("0x%04x",zNode.getManufacturer()));
break;
case REPORT_DEVICE_TYPE:
value=new StringType(String.format("0x%04x",zNode.getDeviceType()));
break;
case REPORT_DEVICE_TYPE_ID:
value=new StringType(String.format("0x%04x",zNode.getDeviceId()));
break;
case REPORT_BASIC:
value=new StringType(String.format("0x%02x",zNode.getDeviceClass().getBasicDeviceClass().getKey()));
break;
case REPORT_BASIC_LABEL:
value=new StringType(String.format("%s",zNode.getDeviceClass().getBasicDeviceClass().getLabel()));
break;
case REPORT_GENERIC:
value=new StringType(String.format("0x%02x",zNode.getDeviceClass().getGenericDeviceClass().getKey()));
break;
case REPORT_GENERIC_LABEL:
value=new StringType(String.format("%s",zNode.getDeviceClass().getGenericDeviceClass().getLabel()));
break;
case REPORT_SPECIFIC:
value=new StringType(String.format("0x%02x",zNode.getDeviceClass().getSpecificDeviceClass().getKey()));
break;
case REPORT_SPECIFIC_LABEL:
value=new StringType(String.format("%s",zNode.getDeviceClass().getSpecificDeviceClass().getLabel()));
break;
case REPORT_VERSION:
value=new StringType(String.format("%s",zNode.getVersion()));
break;
case REPORT_ROUTING:
value=new StringType(String.format("%s",(zNode.isRouting() == true) ? "True" : "False"));
break;
case REPORT_LISTENING:
value=new StringType(String.format("%s",(zNode.isListening() == true) ? "True" : "False"));
break;
case REPORT_SLEEPING_DEAD:
value=new StringType(String.format("%s",(zNode.isSleepingOrDead() == true) ? "True" : "False"));
break;
case REPORT_NAK:
value=new StringType(String.format("%d",this.zController.getNAKCount()));
break;
case REPORT_SOF:
value=new StringType(String.format("%d",this.zController.getSOFCount()));
break;
case REPORT_CAN:
value=new StringType(String.format("%d",this.zController.getCANCount()));
break;
case REPORT_ACK:
value=new StringType(String.format("%d",this.zController.getACKCount()));
break;
case REPORT_OOF:
value=new StringType(String.format("%d",this.zController.getOOFCount()));
break;
case REPORT_LASTUPDATE:
value=new StringType(SIMPLE_DATE_FORMAT.format(zNode.getLastUpdated()).toString());
break;
case REPORT_WAKE_UP_INTERVAL:
value=new StringType("");
ZWaveWakeUpCommandClass wakeUpCommandClass=(ZWaveWakeUpCommandClass)zNode.getCommandClass(CommandClass.WAKE_UP);
if (wakeUpCommandClass != null) value=new StringType(String.format("%d",wakeUpCommandClass.getInterval()));
break;
default :
logger.warn("ZWave Binding Action not supported! ZWave Binding Action = {}",action);
continue;
}
eventPublisher.postUpdate(itemName,value);
}
}
}
