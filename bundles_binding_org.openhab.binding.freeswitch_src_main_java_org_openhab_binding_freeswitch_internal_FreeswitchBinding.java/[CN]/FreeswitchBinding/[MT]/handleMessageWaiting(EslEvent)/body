{
  String account=null;
  try {
    account=URLDecoder.decode(getHeader(event,FS_MWI_ACCOUNT),"UTF-8");
  }
 catch (  UnsupportedEncodingException e) {
    logger.error("Could not decode account",e);
    return;
  }
  boolean waiting="yes".equalsIgnoreCase(getHeader(event,FS_MWI_WAITING));
  logger.debug(String.format("MWI event\\n %s",event.toString()));
  String messagesString=getHeader(event,FS_MWI_MESSAGE);
  logger.debug(String.format("Message header: %s",messagesString));
  if (StringUtils.isBlank(messagesString)) {
    logger.warn("Invalid message string, aborting");
    return;
  }
  Pattern pattern=Pattern.compile("([0-9]+)/([0-9]+)\\s\\([0-9]+\\/[0-9]+\\)");
  Matcher matcher=pattern.matcher(messagesString);
  int messages=0;
  if (matcher.matches()) {
    logger.debug("trying to parse message number");
    try {
      messages=Integer.parseInt(matcher.group(1));
    }
 catch (    Exception e) {
      logger.warn("Could not parse message number",e);
    }
  }
  logger.debug(String.format("Updating MWI to %d VMs",messages));
  mwiCache.put(account,new MWIModel(waiting,messages));
  updateMessageWaitingItems();
}
