{
  try {
    com.sun.jersey.core.osgi.Activator jerseyActivator=new com.sun.jersey.core.osgi.Activator();
    BundleContext bundleContext=FrameworkUtil.getBundle(this.getClass()).getBundleContext();
    try {
      jerseyActivator.start(bundleContext);
    }
 catch (    Exception e) {
      logger.error("Could not start Jersey framework",e);
    }
    String bundleProperty=bundleContext.getProperty("jetty.port");
    if (bundleProperty != null) {
      httpPort=Integer.parseInt(bundleProperty);
    }
 else {
      httpPort=-1;
    }
    bundleProperty=bundleContext.getProperty("jetty.port.ssl");
    if (bundleProperty != null) {
      httpSSLPort=Integer.parseInt(bundleProperty);
    }
 else {
      httpSSLPort=-1;
    }
    if (httpPort < 0 && httpSSLPort < 0) {
      logger.error("Please set at least one of jetty.port, jetty.port.ssl property");
      throw new RuntimeException("There are no jetty ports settings");
    }
    httpService.registerServlet(CV_SERVLET_ALIAS,new AtmosphereServlet(),getJerseyServletParams(),createHttpContext());
    logger.info("Started Cometvisu API at " + CV_SERVLET_ALIAS);
    if (discoveryService != null) {
      if (httpPort > 0) {
        discoveryService.registerService(getDefaultServiceDescription());
      }
      if (httpSSLPort > 0) {
        discoveryService.registerService(getSSLServiceDescription());
      }
    }
  }
 catch (  ServletException se) {
    throw new RuntimeException(se);
  }
catch (  NamespaceException se) {
    throw new RuntimeException(se);
  }
}
