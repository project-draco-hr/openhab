{
  logger.debug("Started synchronization from local to Dropbox ...");
  WebAuthSession session=getSession();
  if (session == null) {
    return;
  }
  DropboxAPI<WebAuthSession> dropbox=new DropboxAPI<WebAuthSession>(session);
  Map<String,Long> dropboxEntries=new HashMap<String,Long>();
  Entry metadata=dropbox.metadata("/",-1,null,true,null);
  File dropboxEntryFile=new File(contentDir + DROPBOX_ENTRIES_FILE_NAME);
  if (!dropboxEntryFile.exists() || !metadata.hash.equals(lastHash)) {
    collectDropboxEntries(dropbox,dropboxEntries,"/");
    serializeDropboxEntries(dropboxEntryFile,dropboxEntries);
    lastHash=metadata.hash;
  }
 else {
    logger.trace("Dropbox entry file '{}' exists -> extract content",dropboxEntryFile.getPath());
    dropboxEntries=extractDropboxEntries(dropboxEntryFile);
  }
  Map<String,Long> localEntries=new HashMap<String,Long>();
  collectLocalEntries(localEntries,contentDir);
  logger.debug("There are '{}' local entries that met the upload filters ...",localEntries.size());
  boolean isChanged=false;
  for (  java.util.Map.Entry<String,Long> entry : localEntries.entrySet()) {
    if (dropboxEntries.containsKey(entry.getKey())) {
      if (entry.getValue().compareTo(dropboxEntries.get(entry.getKey())) > 0) {
        logger.trace("Local file '{}' is newer - upload to Dropbox!",entry.getKey());
        isChanged=true;
      }
    }
 else {
      logger.trace("Local file '{}' doesn't exist in Dropbox - upload to Dropbox!",entry.getKey());
      isChanged=true;
    }
    dropboxEntries.remove(entry.getKey());
  }
  for (  String path : dropboxEntries.keySet()) {
    for (    String filter : uploadFilterElements) {
      if (path.matches(filter)) {
        isChanged=true;
        logger.debug("Successfully deleted file '{}' from Dropbox",path);
      }
 else {
        logger.trace("skipped file '{}' since it doesn't match the given filter arguments.",path);
      }
    }
  }
  if (isChanged) {
    boolean success=FileUtils.deleteQuietly(dropboxEntryFile);
    if (!success) {
      logger.warn("Couldn't delete file '{}'",dropboxEntryFile.getPath());
    }
 else {
      logger.debug("Deleted cache file '{}' since there are changes. It will be recreated while next synchronization loop.",dropboxEntryFile.getPath());
    }
    DeltaPage<Entry> deltaPage=dropbox.delta(lastCursor);
    writeLastCursorFile(deltaPage,new File(contentDir + DELTA_CURSOR_FILE_NAME));
  }
 else {
    logger.debug("There are no deltas to upload into Dropbox ...");
  }
}
