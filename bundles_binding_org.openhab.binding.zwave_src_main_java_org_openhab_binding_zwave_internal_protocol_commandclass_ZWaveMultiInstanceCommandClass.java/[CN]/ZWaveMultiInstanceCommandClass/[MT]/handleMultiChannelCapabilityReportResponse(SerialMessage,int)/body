{
  logger.debug("NODE {}: Process Multi-channel capability Report",this.getNode().getNodeId());
  int receivedEndpointId=serialMessage.getMessagePayloadByte(offset) & 0x7F;
  boolean dynamic=((serialMessage.getMessagePayloadByte(offset) & 0x80) != 0);
  int genericDeviceClass=serialMessage.getMessagePayloadByte(offset + 1);
  int specificDeviceClass=serialMessage.getMessagePayloadByte(offset + 2);
  logger.debug("NODE {}: Endpoints are the same device class = {}",this.getNode().getNodeId(),endpointsAreTheSameDeviceClass ? "true" : false);
  int startId=this.endpointsAreTheSameDeviceClass ? 1 : receivedEndpointId;
  int endId=this.endpointsAreTheSameDeviceClass ? this.endpoints.size() : receivedEndpointId;
  boolean supportsBasicCommandClass=this.getNode().supportsCommandClass(CommandClass.BASIC);
  for (int endpointId=startId; endpointId <= endId; endpointId++) {
    ZWaveEndpoint endpoint=this.endpoints.get(endpointId);
    if (endpoint == null) {
      logger.error("NODE {}: Endpoint {} not found. Cannot set command classes.",this.getNode().getNodeId(),endpointId);
      continue;
    }
    Basic basic=this.getNode().getDeviceClass().getBasicDeviceClass();
    Generic generic=Generic.getGeneric(genericDeviceClass);
    if (generic == null) {
      logger.error(String.format("NODE %d: Endpoint %d has invalid device class. generic = 0x%02x, specific = 0x%02x.",this.getNode().getNodeId(),endpoint,genericDeviceClass,specificDeviceClass));
      continue;
    }
    Specific specific=Specific.getSpecific(generic,specificDeviceClass);
    if (specific == null) {
      logger.error(String.format("NODE %d: Endpoint %d has invalid device class. generic = 0x%02x, specific = 0x%02x.",this.getNode().getNodeId(),endpoint,genericDeviceClass,specificDeviceClass));
      continue;
    }
    logger.debug("NODE {}: Endpoint Id = {}",this.getNode().getNodeId(),endpointId);
    logger.debug("NODE {}: Endpoints is dynamic = {}",this.getNode().getNodeId(),dynamic ? "true" : false);
    logger.debug(String.format("NODE %d: Basic = %s 0x%02x",this.getNode().getNodeId(),basic.getLabel(),basic.getKey()));
    logger.debug(String.format("NODE %d: Generic = %s 0x%02x",this.getNode().getNodeId(),generic.getLabel(),generic.getKey()));
    logger.debug(String.format("NODE %d: Specific = %s 0x%02x",this.getNode().getNodeId(),specific.getLabel(),specific.getKey()));
    ZWaveDeviceClass deviceClass=endpoint.getDeviceClass();
    deviceClass.setBasicDeviceClass(basic);
    deviceClass.setGenericDeviceClass(generic);
    deviceClass.setSpecificDeviceClass(specific);
    if (supportsBasicCommandClass) {
      ZWaveCommandClass commandClass=new ZWaveBasicCommandClass(this.getNode(),this.getController(),endpoint);
      endpoint.addCommandClass(commandClass);
    }
    for (int i=0; i < serialMessage.getMessagePayload().length - offset - 3; i++) {
      int data=serialMessage.getMessagePayloadByte(offset + 3 + i);
      if (data == 0xef) {
        break;
      }
      ZWaveCommandClass commandClass=ZWaveCommandClass.getInstance(data,this.getNode(),this.getController(),endpoint);
      if (commandClass == null) {
        continue;
      }
      logger.debug("NODE {}: Adding command class {} to the list of supported command classes.",this.getNode().getNodeId(),commandClass.getCommandClass().getLabel());
      endpoint.addCommandClass(commandClass);
      ZWaveCommandClass parentClass=this.getNode().getCommandClass(commandClass.getCommandClass());
      if (parentClass != null) {
        commandClass.setVersion(parentClass.getVersion());
      }
    }
  }
  if (!this.endpointsAreTheSameDeviceClass) {
    for (    ZWaveEndpoint ep : this.endpoints.values()) {
      if (ep.getDeviceClass().getBasicDeviceClass() == Basic.NOT_KNOWN) {
        return;
      }
    }
  }
}
