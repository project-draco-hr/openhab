{
  for (  String device : connectorThreads.keySet()) {
    logger.debug("Close previous message listener for device '" + device + "'");
    final AnelConnectorThread connectorThread=connectorThreads.get(device);
    connectorThread.setInterrupted();
  }
  for (  String device : connectorThreads.keySet()) {
    final AnelConnectorThread connectorThread=connectorThreads.get(device);
    try {
      connectorThread.join();
    }
 catch (    InterruptedException e) {
      logger.info("Previous message listener closing interrupted for device '" + device + "'",e);
    }
  }
  connectorThreads.clear();
  refreshInterval=0;
  try {
    refreshInterval=AnelConfigReader.readConfig(config,connectorThreads,bindingFacade);
    logger.debug("Anel configuration read with refresh interval " + refreshInterval + "ms and "+ connectorThreads.size()+ " devices.");
  }
 catch (  ConfigurationException e) {
    logger.error("Could not read configuration for Anel binding: " + e.getMessage());
    return;
  }
catch (  Exception e) {
    logger.error("Could not read configuration for Anel binding",e);
    return;
  }
  setProperlyConfigured(true);
  for (  String device : connectorThreads.keySet()) {
    final AnelConnectorThread connectorThread=connectorThreads.get(device);
    logger.debug("Starting message listener for device: " + connectorThread);
    connectorThread.start();
  }
  new Thread(new Runnable(){
    @Override public void run(){
      try {
        Thread.sleep(30000);
      }
 catch (      InterruptedException e) {
      }
      for (      AnelConnectorThread connectorThread : connectorThreads.values()) {
        connectorThread.requestRefresh();
      }
    }
  }
).start();
}
