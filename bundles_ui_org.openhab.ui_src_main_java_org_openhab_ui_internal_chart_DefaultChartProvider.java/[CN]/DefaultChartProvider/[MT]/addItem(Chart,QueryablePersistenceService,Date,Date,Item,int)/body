{
  Color color=LINECOLORS[seriesCounter % LINECOLORS.length];
  String label=null;
  if (itemUIRegistry != null) {
    label=itemUIRegistry.getLabel(item.getName());
    if (label != null && label.contains("[") && label.contains("]")) {
      label=label.substring(0,label.indexOf('['));
    }
  }
  if (label == null)   label=item.getName();
  FilterCriteria filter=new FilterCriteria();
  filter.setBeginDate(timeBegin);
  filter.setEndDate(timeEnd);
  filter.setItemName(item.getName());
  filter.setOrdering(Ordering.ASCENDING);
  Iterable<HistoricItem> result=service.query(filter);
  Iterator<HistoricItem> it=result.iterator();
  Collection<Date> xData=new ArrayList<Date>();
  Collection<Number> yData=new ArrayList<Number>();
  while (it.hasNext()) {
    HistoricItem historicItem=it.next();
    org.openhab.core.types.State state=historicItem.getState();
    if (state instanceof DecimalType) {
      xData.add(historicItem.getTimestamp());
      yData.add((DecimalType)state);
    }
  }
  if (xData.size() == 0)   return false;
  if (xData.size() == 1) {
    xData.add(xData.iterator().next());
    yData.add(yData.iterator().next());
  }
  Series series=chart.addDateSeries(label,xData,yData);
  series.setLineStyle(new BasicStroke(1.5f));
  series.setMarker(SeriesMarker.NONE);
  series.setLineColor(color);
  if (yData.iterator().next().floatValue() > ((series.getyMax().floatValue() - series.getyMin().floatValue()) / 2 + series.getyMin().floatValue())) {
    legendPosition++;
  }
 else {
    legendPosition--;
  }
  return true;
}
