{
  Color color=LINECOLORS[seriesCounter % LINECOLORS.length];
  String label=null;
  if (itemUIRegistry != null) {
    label=itemUIRegistry.getLabel(item.getName());
    if (label != null && label.contains("[") && label.contains("]")) {
      label=label.substring(0,label.indexOf('['));
    }
  }
  if (label == null) {
    label=item.getName();
  }
  Iterable<HistoricItem> result;
  FilterCriteria filter;
  Collection<Date> xData=new ArrayList<Date>();
  Collection<Number> yData=new ArrayList<Number>();
  org.openhab.core.types.State state=null;
  filter=new FilterCriteria();
  filter.setEndDate(timeBegin);
  filter.setItemName(item.getName());
  filter.setPageSize(1);
  filter.setOrdering(Ordering.DESCENDING);
  result=service.query(filter);
  logger.debug("CHART: Performing start query - " + filter.toString());
  if (result.iterator().hasNext()) {
    logger.debug("CHART: Performing start query - returned DATA");
    HistoricItem historicItem=result.iterator().next();
    state=historicItem.getState();
    if (state instanceof DecimalType) {
      logger.debug("CHART: Performing start query - returned DATA - Decimal");
      xData.add(timeBegin);
      yData.add((DecimalType)state);
    }
  }
  filter.setBeginDate(timeBegin);
  filter.setEndDate(timeEnd);
  filter.setPageSize(Integer.MAX_VALUE);
  filter.setOrdering(Ordering.ASCENDING);
  result=service.query(filter);
  Iterator<HistoricItem> it=result.iterator();
  logger.debug("CHART: Performing main query");
  while (it.hasNext()) {
    logger.debug("CHART: Performing main query - returned data");
    HistoricItem historicItem=it.next();
    state=historicItem.getState();
    if (state instanceof DecimalType) {
      logger.debug("CHART: Performing main query - data");
      xData.add(historicItem.getTimestamp());
      yData.add((DecimalType)state);
    }
  }
  if (state != null && state instanceof DecimalType) {
    logger.debug("CHART: Adding end point");
    xData.add(timeEnd);
    yData.add((DecimalType)state);
  }
  if (xData.size() == 0) {
    return false;
  }
  if (xData.size() == 1) {
    logger.debug("CHART: Single point");
    xData.add(xData.iterator().next());
    yData.add(yData.iterator().next());
  }
  Series series=chart.addDateSeries(label,xData,yData);
  series.setLineStyle(new BasicStroke(1.5f));
  series.setMarker(SeriesMarker.NONE);
  series.setLineColor(color);
  if (yData.iterator().next().floatValue() > ((series.getyMax().floatValue() - series.getyMin().floatValue()) / 2 + series.getyMin().floatValue())) {
    legendPosition++;
  }
 else {
    legendPosition--;
  }
  return true;
}
