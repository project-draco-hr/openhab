{
  Color color=LINECOLORS[seriesCounter % LINECOLORS.length];
  seriesCounter++;
  String label=null;
  if (itemUIRegistry != null) {
    label=itemUIRegistry.getLabel(item.getName());
    if (label != null && label.contains("[") && label.contains("]")) {
      label=label.substring(0,label.indexOf('['));
    }
  }
  if (label == null)   label=item.getName();
  FilterCriteria filter=new FilterCriteria();
  filter.setBeginDate(timeBegin);
  filter.setEndDate(timeEnd);
  filter.setItemName(item.getName());
  filter.setOrdering(Ordering.ASCENDING);
  Iterable<HistoricItem> result=service.query(filter);
  Iterator<HistoricItem> it=result.iterator();
  Collection<Date> xData=new ArrayList<Date>();
  Collection<Number> yData=new ArrayList<Number>();
  DecimalType initState=null;
  while (it.hasNext()) {
    HistoricItem historicItem=it.next();
    org.openhab.core.types.State state=historicItem.getState();
    if (state instanceof DecimalType) {
      DecimalType value=(DecimalType)state;
      if (initState == null)       initState=value;
      xData.add(historicItem.getTimestamp());
      yData.add(value);
    }
  }
  if (xData.size() < 2 || yData.size() < 2)   return;
  Series series=chart.addDateSeries(label,xData,yData);
  series.setLineStyle(new BasicStroke(1.5f));
  series.setMarker(SeriesMarker.NONE);
  series.setLineColor(color);
  if (initState.floatValue() > ((series.getyMax().floatValue() - series.getyMin().floatValue()) / 2 + series.getyMin().floatValue())) {
    legendPosition++;
  }
 else {
    legendPosition--;
  }
}
