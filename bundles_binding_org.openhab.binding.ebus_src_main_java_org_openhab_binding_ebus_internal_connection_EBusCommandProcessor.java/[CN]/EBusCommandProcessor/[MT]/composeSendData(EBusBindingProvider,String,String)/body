{
  if (configurationProvider == null || configurationProvider.isEmpty()) {
    logger.debug("eBus configuration provider not ready, can't get send data yet.");
    return null;
  }
  byte[] data=null;
  String cmd=provider.getCommand(itemName);
  String cmdClass=provider.getCommandClass(itemName);
  Map<String,Object> command2=null;
  command2=configurationProvider.getCommandById(cmd,cmdClass);
  if (command2 != null) {
    byte[] b=EBusUtils.toByteArray((String)command2.get("data"));
    byte[] b2=EBusUtils.toByteArray((String)command2.get("command"));
    Byte dst=provider.getTelegramDestination(itemName);
    Byte src=provider.getTelegramSource(itemName);
    if (dst == null) {
      throw new RuntimeException("no destination!");
    }
    if (src == null) {
      src=connector.getSenderId();
    }
    byte[] buffer=new byte[b.length + 6];
    buffer[0]=src;
    buffer[1]=dst;
    buffer[4]=(byte)b.length;
    System.arraycopy(b2,0,buffer,2,b2.length);
    System.arraycopy(b,0,buffer,5,b.length);
    data=buffer;
  }
  if (data == null && StringUtils.isNotEmpty(type)) {
    data=provider.getTelegramData(itemName,type);
  }
  if (data == null) {
    data=provider.getTelegramData(itemName);
  }
  return data;
}
