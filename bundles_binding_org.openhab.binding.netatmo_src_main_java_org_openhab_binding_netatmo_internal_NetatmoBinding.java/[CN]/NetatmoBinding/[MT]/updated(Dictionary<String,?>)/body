{
  if (config != null) {
    final String refreshIntervalString=(String)config.get(CONFIG_REFRESH);
    if (isNotBlank(refreshIntervalString)) {
      this.refreshInterval=Long.parseLong(refreshIntervalString);
    }
    Enumeration<String> configKeys=config.keys();
    while (configKeys.hasMoreElements()) {
      String configKey=(String)configKeys.nextElement();
      if (CONFIG_REFRESH.equals(configKey) || "service.pid".equals(configKey)) {
        continue;
      }
      String userid;
      String configKeyTail;
      if (configKey.contains(".")) {
        String[] keyElements=configKey.split("\\.");
        userid=keyElements[0];
        configKeyTail=keyElements[1];
      }
 else {
        userid=DEFAULT_USER_ID;
        configKeyTail=configKey;
      }
      OAuthCredentials credentials=credentialsCache.get(userid);
      if (credentials == null) {
        credentials=new OAuthCredentials();
        credentialsCache.put(userid,credentials);
      }
      String value=(String)config.get(configKeyTail);
      if (CONFIG_CLIENT_ID.equals(configKeyTail)) {
        credentials.clientId=value;
      }
 else       if (CONFIG_CLIENT_SECRET.equals(configKeyTail)) {
        credentials.clientSecret=value;
      }
 else       if (CONFIG_REFRESH_TOKEN.equals(configKeyTail)) {
        credentials.refreshToken=value;
      }
 else {
        throw new ConfigurationException(configKey,"the given configKey '" + configKey + "' is unknown");
      }
    }
    setProperlyConfigured(true);
  }
}
