{
  logger.debug("Querying Netatmo API");
  for (  String userid : credentialsCache.keySet()) {
    OAuthCredentials oauthCredentials=getOAuthCredentials(userid);
    if (oauthCredentials.noAccessToken()) {
      oauthCredentials.refreshAccessToken();
    }
    try {
      if (oauthCredentials.firstExecution) {
        processDeviceList(oauthCredentials);
      }
      Map<String,Map<String,BigDecimal>> deviceMeasureValueMap=processMeasurements(oauthCredentials);
      for (      final NetatmoBindingProvider provider : this.providers) {
        for (        final String itemName : provider.getItemNames()) {
          final String deviceId=provider.getDeviceId(itemName);
          final String moduleId=provider.getModuleId(itemName);
          final String measure=provider.getMeasure(itemName);
          final String requestKey=createKey(deviceId,moduleId);
          final State state=new DecimalType(deviceMeasureValueMap.get(requestKey).get(measure));
          if (state != null) {
            this.eventPublisher.postUpdate(itemName,state);
          }
        }
      }
    }
 catch (    NetatmoException ne) {
      logger.error(ne.getMessage());
    }
  }
}
