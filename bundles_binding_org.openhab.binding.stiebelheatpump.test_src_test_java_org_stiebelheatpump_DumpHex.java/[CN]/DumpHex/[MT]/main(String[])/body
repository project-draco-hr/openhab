{
  if (args.length < 1 || args.length > 5) {
    printUsage();
    System.exit(1);
  }
  for (int i=0; i < args.length; i++) {
    if (args[i].equals("-b")) {
      if (++i == args.length) {
        printUsage();
        System.exit(1);
      }
      try {
        baudRate=Integer.parseInt(args[i]);
      }
 catch (      NumberFormatException e) {
        printUsage();
        System.exit(1);
      }
    }
 else     if (args[i].equals("-c")) {
      if (++i == args.length) {
        printUsage();
        System.exit(1);
      }
      configFile=args[i];
    }
 else     if (args[i].equals("-d")) {
      if (++i == args.length) {
        printUsage();
        System.exit(1);
      }
      serialPortName=args[i];
    }
  }
  try {
    CommunicationService communicationService=new CommunicationService(serialPortName,baudRate);
    Map<String,String> data=new HashMap<String,String>();
    byte[] requestBytes=null;
    if (!configFile.isEmpty()) {
      List<Request> requests=communicationService.getHeatPumpConfiguration(configFile);
      requestBytes=new byte[requests.size()];
      int position=0;
      for (      Request request : requests) {
        requestBytes[position]=request.getRequestByte();
      }
    }
 else {
      requestBytes=new byte[]{(byte)0xfc,(byte)0x09,(byte)0xfb};
    }
    Request versionRequest=new Request("Version","Read version information",(byte)0xfd);
    versionRequest.getRecordDefinitions().add(new RecordDefinition("Version",4,2,0.01,RecordDefinition.Type.Status,""));
    data=communicationService.readData(versionRequest);
    for (    Map.Entry<String,String> entry : data.entrySet()) {
      logger.info("Heat pump has version {}",entry.getValue());
      break;
    }
    for (    byte requestByte : requestBytes) {
      communicationService.dumpResponse(requestByte);
    }
    communicationService.finalizer();
  }
 catch (  StiebelHeatPumpException e) {
    logger.error("Error : {}",e.toString());
  }
  System.exit(0);
}
