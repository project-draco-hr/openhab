{
synchronized (listeners) {
    HashSet<StateChangeListener> clonedListeners=new HashSet<StateChangeListener>(listeners);
    for (    StateChangeListener listener : clonedListeners) {
      listener.stateUpdated(this,newState);
    }
    if (!oldState.equals(newState)) {
      for (      StateChangeListener listener : clonedListeners) {
        listener.stateChanged(this,oldState,newState);
      }
    }
  }
}
