{
  String basePath;
  ItemBean itemBean=null;
  Collection<Broadcaster> broadcasters=BroadcasterFactory.getDefault().lookupAll();
  Broadcaster mainBroadcaster=broadcasters.iterator().next();
  Collection<AtmosphereResource<?,?>> ars=mainBroadcaster.getAtmosphereResources();
  if (ars != null && !ars.isEmpty()) {
    Broadcaster itemBroadcaster=BroadcasterFactory.getDefault().lookup(JerseyBroadcaster.class,"ItemBroadcaster",true);
    for (    AtmosphereResource<?,?> ar : ars) {
      Object req=ar.getRequest();
      if (req instanceof HttpServletRequest) {
        HttpServletRequest request=(HttpServletRequest)req;
        basePath=request.getScheme() + "://" + request.getServerName()+ ":"+ request.getServerPort()+ request.getContextPath()+ REST_SERVLET_ALIAS+ "/";
        itemBean=ItemResource.createItemBean(item,true,basePath);
        String pathInfo=((HttpServletRequest)req).getPathInfo();
        String servletLink=UriBuilder.fromUri(basePath).path(ItemResource.PATH_ITEMS).path("/").build().toASCIIString();
        String requestLink=UriBuilder.fromUri(basePath).path(pathInfo).path("/").build().toASCIIString();
        String itemLink=UriBuilder.fromUri(itemBean.link).path("/").build().toASCIIString();
        if (itemLink.equals(requestLink) || servletLink.equals(requestLink)) {
          itemBroadcaster.addAtmosphereResource(ar);
        }
        if (pathInfo.contains("sitemaps")) {
          String[] split=pathInfo.split("/");
          ArrayList<String> sitemapPathParams=new ArrayList<String>(split.length);
          for (          String res : split)           if (res.length() > 0)           sitemapPathParams.add(res);
          if (sitemapPathParams.size() >= 1) {
            UriBuilder baseUriBuilder=UriBuilder.fromUri(basePath);
            SitemapResource sr=new SitemapResource();
switch (sitemapPathParams.size()) {
case 1:
              Collection<SitemapBean> sitemaps=sr.getSitemapBeans(baseUriBuilder.build());
            for (            SitemapBean sitemapBean : sitemaps) {
              if (isItemOnPage(sitemapBean.homepage.widgets,itemBean)) {
                itemBroadcaster.addAtmosphereResource(ar);
              }
            }
          break;
case 2:
        SitemapBean sitemapBean=sr.getSitemapBean(sitemapPathParams.get(1),baseUriBuilder.build());
      if (isItemOnPage(sitemapBean.homepage.widgets,itemBean)) {
        itemBroadcaster.addAtmosphereResource(ar);
      }
    break;
case 3:
  PageBean pageBean=sr.getPageBean(sitemapPathParams.get(1),sitemapPathParams.get(2),baseUriBuilder.build());
if (isItemOnPage(pageBean.widgets,itemBean)) {
  itemBroadcaster.addAtmosphereResource(ar);
}
break;
}
}
}
}
}
itemBroadcaster.broadcast(itemBean);
}
}
