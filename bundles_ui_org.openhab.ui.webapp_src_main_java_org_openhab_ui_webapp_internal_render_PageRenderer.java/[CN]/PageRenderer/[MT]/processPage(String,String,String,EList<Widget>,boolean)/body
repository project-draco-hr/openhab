{
  String snippet=getSnippet(async ? "layer" : "main");
  snippet=snippet.replaceAll("%id%",id);
  if (label.contains("[") && label.endsWith("]")) {
    label=label.replace("[","").replace("]","");
  }
  snippet=StringUtils.replace(snippet,"%label%",label);
  snippet=StringUtils.replace(snippet,"%servletname%",WebAppServlet.SERVLET_NAME);
  snippet=StringUtils.replace(snippet,"%sitemap%",sitemap);
  String[] parts=snippet.split("%children%");
  StringBuilder pre_children=new StringBuilder(parts[0]);
  StringBuilder post_children=new StringBuilder(parts[1]);
  if (parts.length == 2) {
    processChildren(pre_children,post_children,children);
  }
 else   if (parts.length > 2) {
    logger.error("Snippet '{}' contains multiple %children% sections, but only one is allowed!",async ? "layer" : "main");
  }
  return pre_children.append(post_children);
}
