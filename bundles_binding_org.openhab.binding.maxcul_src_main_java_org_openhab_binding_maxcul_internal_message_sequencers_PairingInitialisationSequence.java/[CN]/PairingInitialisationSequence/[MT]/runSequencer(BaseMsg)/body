{
  pktLostCount=0;
switch (state) {
case INITIAL_PING:
    logger.debug("Sending PONG");
  this.devAddr=msg.srcAddrStr;
messageHandler.sendPairPong(devAddr,this);
state=PairingInitialisationState.PONG_ACKED;
break;
case PONG_ACKED:
if (msg.msgType == MaxCulMsgType.ACK) {
AckMsg ack=new AckMsg(msg.rawMsg);
if (!ack.getIsNack()) {
logger.debug("Sending WAKEUP");
messageHandler.sendWakeup(devAddr,this);
state=PairingInitialisationState.WAKEUP_ACKED;
}
 else {
logger.error("PONG was nacked. Ending sequence");
state=PairingInitialisationState.FINISHED;
}
}
break;
case WAKEUP_ACKED:
if (msg.msgType == MaxCulMsgType.ACK) {
AckMsg ack=new AckMsg(msg.rawMsg);
if (!ack.getIsNack()) {
logger.debug("Sending TIME_INFO");
messageHandler.sendTimeInfo(devAddr,tzStr,this);
state=PairingInitialisationState.TIME_ACKED;
}
 else {
logger.error("WAKEUP was nacked. Ending sequence");
state=PairingInitialisationState.FINISHED;
}
}
break;
case TIME_ACKED:
if (msg.msgType == MaxCulMsgType.ACK) {
AckMsg ack=new AckMsg(msg.rawMsg);
if (!ack.getIsNack()) {
logger.debug("Sending GROUP_ID");
messageHandler.sendSetGroupId(devAddr,group_id,this);
state=PairingInitialisationState.GROUP_ID_ACKED;
}
 else {
logger.error("TIME_INFO was nacked. Ending sequence");
state=PairingInitialisationState.FINISHED;
}
}
break;
case GROUP_ID_ACKED:
if (msg.msgType == MaxCulMsgType.ACK) {
AckMsg ack=new AckMsg(msg.rawMsg);
if (!ack.getIsNack()) {
state=PairingInitialisationState.FINISHED;
}
 else {
logger.error("SET_GROUP_ID was nacked. Ending sequence");
state=PairingInitialisationState.FINISHED;
}
}
break;
case CONFIG_TEMPS_ACKED:
state=PairingInitialisationState.FINISHED;
break;
case SENDING_WEEK_PROFILE:
state=PairingInitialisationState.FINISHED;
break;
case CONFIG_TEMPS_2_ACKED:
state=PairingInitialisationState.FINISHED;
break;
case FINISHED:
break;
default :
logger.error("Invalid state for PairingInitialisation Message Sequence!");
break;
}
}
