{
synchronized (this) {
    if (sonosSavedGroupState != null && sonosSavedPlayerState != null) {
    }
    sonosSavedPlayerState=new HashMap<String,SonosZonePlayerState>();
    sonosSavedGroupState=new ArrayList<SonosZoneGroup>();
    for (    SonosZoneGroup group : getSonosZoneGroups()) {
      sonosSavedGroupState.add((SonosZoneGroup)group.clone());
    }
    for (    SonosZoneGroup group : sonosSavedGroupState) {
      for (      String playerName : group.getMembers()) {
        SonosZonePlayer player=getPlayerForID(playerName);
        SonosZonePlayerState saveState=new SonosZonePlayerState();
        String currentURI=player.getCurrentURI();
        if (currentURI != null) {
          if (currentURI.contains("x-sonosapi-stream:")) {
            SonosMetaData track=player.getTrackMetadata();
            SonosMetaData current=player.getCurrentURIMetadata();
            if (track != null) {
              saveState.entry=new SonosEntry("",current.getTitle(),"","",track.getAlbumArtUri(),"",current.getUpnpClass(),currentURI);
            }
          }
 else           if (currentURI.contains("x-rincon:")) {
            saveState.entry=new SonosEntry("","","","","","","",currentURI);
          }
 else           if (currentURI.contains("x-rincon-stream:")) {
            saveState.entry=new SonosEntry("","","","","","","",currentURI);
          }
 else           if (currentURI.contains("x-rincon-queue:")) {
            SonosMetaData queued=player.getEnqueuedTransportURIMetaData();
            if (queued != null) {
              saveState.track=player.getCurrenTrackNr();
              if (queued.getUpnpClass().contains("object.container.playlistContainer")) {
                List<SonosEntry> playLists=player.getPlayLists();
                for (                SonosEntry someList : playLists) {
                  if (someList.getTitle().equals(queued.getTitle())) {
                    saveState.entry=new SonosEntry(someList.getId(),someList.getTitle(),someList.getParentId(),"","","",someList.getUpnpClass(),someList.getRes());
                    break;
                  }
                }
              }
 else               if (queued.getUpnpClass().contains("object.container")) {
                logger.debug("Save State for a container of type {}",queued.getUpnpClass());
                String existingList="";
                List<SonosEntry> playLists=player.getPlayLists();
                for (                SonosEntry someList : playLists) {
                  if (someList.getTitle().equals("openHAB-" + player.getUdn())) {
                    existingList=someList.getId();
                    break;
                  }
                }
                player.saveQueue("openHAB-" + player.getUdn(),existingList);
                playLists=player.getPlayLists();
                for (                SonosEntry someList : playLists) {
                  if (someList.getTitle().equals("openHAB-" + player.getUdn())) {
                    saveState.entry=new SonosEntry(someList.getId(),someList.getTitle(),someList.getParentId(),"","","",someList.getUpnpClass(),someList.getRes());
                    break;
                  }
                }
              }
            }
 else {
              saveState.entry=new SonosEntry("","","","","","","","x-rincon-queue:" + player.getUdn().getIdentifierString() + "#0");
            }
          }
          saveState.transportState=player.getTransportState();
          saveState.volume=player.getCurrentVolume();
          saveState.relTime=player.getPosition();
        }
 else {
          saveState.entry=null;
        }
        sonosSavedPlayerState.put(playerName,saveState);
      }
    }
    return true;
  }
}
