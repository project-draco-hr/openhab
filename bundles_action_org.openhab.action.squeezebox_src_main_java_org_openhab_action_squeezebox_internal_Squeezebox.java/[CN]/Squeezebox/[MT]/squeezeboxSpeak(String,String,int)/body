{
  SqueezePlayer player=getPlayer(playerId);
  if (player == null)   return false;
  int playerVolume=player.getUnmuteVolume();
  boolean playerPowered=player.isPowered();
  boolean playerMuted=player.isMuted();
  if (playerMuted) {
    logger.trace("Setting player state: unmuted");
    squeezeServer.unMute(playerId);
  }
  if (volume != -1) {
    logger.trace("Setting player state: volume {}",volume);
    squeezeServer.setVolume(playerId,volume);
  }
  List<String> sentences=getSentences(message,MAX_SENTENCE_LENGTH);
  for (  String sentence : sentences) {
    logger.debug("Sending sentence to " + playerId + " ("+ sentence+ ")");
    String encodedSentence;
    try {
      encodedSentence=URLEncoder.encode(sentence,"UTF-8");
    }
 catch (    UnsupportedEncodingException e) {
      logger.warn("Failed to encode sentence '" + sentence + "'. Skipping sentence.",e);
      continue;
    }
    encodedSentence=encodedSentence.replace("+","%20");
    logger.trace("Encoded sentence " + encodedSentence);
    String url=GOOGLE_TRANSLATE_URL + encodedSentence;
    SqueezeboxListener listener=new SqueezeboxListener(playerId,url);
    player.addPlayerEventListener(listener);
    logger.trace("Sending URL '{}' to device to play",url);
    squeezeServer.playUrl(playerId,url);
    int timeoutCount=0;
    while (!listener.isFinished() && timeoutCount < 100) {
      try {
        Thread.sleep(100);
      }
 catch (      InterruptedException e) {
        break;
      }
      timeoutCount++;
    }
    player.removePlayerEventListener(listener);
    listener=null;
  }
  squeezeServer.clearPlaylist(playerId);
  if (volume != -1) {
    logger.trace("Restoring player to previous state: volume {}",playerVolume);
    squeezeServer.setVolume(playerId,playerVolume);
  }
  if (playerMuted) {
    logger.trace("Restoring player to previous state: muted");
    squeezeServer.mute(playerId);
  }
  if (!playerPowered) {
    logger.trace("Restoring player to previous state: off");
    squeezeServer.powerOff(playerId);
  }
  return true;
}
