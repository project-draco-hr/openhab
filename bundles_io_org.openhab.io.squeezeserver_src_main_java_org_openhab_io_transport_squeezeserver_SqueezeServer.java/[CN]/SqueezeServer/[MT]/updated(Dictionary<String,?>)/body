{
  disconnect();
  host=null;
  cliport=DEFAULT_CLI_PORT;
  webport=DEFAULT_WEB_PORT;
  playerMap=new HashMap<String,String>();
  if (properties == null || properties.isEmpty()) {
    return;
  }
  Enumeration<String> keys=config.keys();
  while (keys.hasMoreElements()) {
    String key=(String)keys.nextElement();
    if ("service.pid".equals(key)) {
      continue;
    }
    Matcher serverMatcher=EXTRACT_SERVER_CONFIG_PATTERN.matcher(key);
    Matcher playerMatcher=EXTRACT_PLAYER_CONFIG_PATTERN.matcher(key);
    String value=(String)config.get(key);
    if (serverMatcher.matches()) {
      serverMatcher.reset();
      serverMatcher.find();
      if ("host".equals(serverMatcher.group(2))) {
        host=value;
      }
 else       if ("cliport".equals(serverMatcher.group(2))) {
        cliport=Integer.valueOf(value);
      }
 else       if ("webport".equals(serverMatcher.group(2))) {
        webport=Integer.valueOf(value);
      }
    }
 else     if (playerMatcher.matches()) {
      SqueezePlayer player=new SqueezePlayer(value.toString(),playerMatcher.group(1));
      playerMap.put(player.getName(),player);
    }
  }
  if (StringUtils.isEmpty(host))   throw new ConfigurationException("host","No Squeeze Server host specified - this property is mandatory");
  if (playerMap.size() == 0)   throw new ConfigurationException("host","No Squeezebox players specified - there must be at least one player");
  connect();
  logger.info("Squeeze Server connection established.");
}
