{
  broadcaster.getBroadcasterConfig().setBroadcasterCache(new CVBroadcasterCache());
  broadcaster.getBroadcasterConfig().getBroadcasterCache().configure(broadcaster.getBroadcasterConfig());
  broadcaster.getBroadcasterConfig().getBroadcasterCache().start();
  broadcaster.getBroadcasterConfig().addFilter(new PerRequestBroadcastFilter(){
    @Override public BroadcastAction filter(    String broadcasterId,    Object originalMessage,    Object message){
      return new BroadcastAction(message);
    }
    @Override public BroadcastAction filter(    String broadcasterId,    AtmosphereResource resource,    Object originalMessage,    Object message){
      HttpServletRequest request=resource.getRequest();
      Object responseObject;
      if (message instanceof Item) {
        responseObject=getSingleResponseObject((Item)message,request);
      }
 else       if (message instanceof ItemStateListBean) {
        responseObject=message;
      }
 else {
        responseObject=getResponseObject(request);
      }
      if (responseObject != null)       return new BroadcastAction(ACTION.CONTINUE,responseObject);
 else       return new BroadcastAction(ACTION.ABORT,message);
    }
  }
);
  broadcaster.getBroadcasterConfig().addFilter(new ResponseObjectFilter());
  stateChangeListener=new StateChangeListener(){
    public void stateUpdated(    Item item,    State state){
      if (item instanceof GroupItem && getRelevantItemNames().containsKey(item.getName())) {
        Collection<ItemBean> beans=new LinkedList<ItemBean>();
        for (        ReturnType rt : getRelevantItemNames().get(item.getName())) {
          if (rt.getStateClass() != null) {
            logger.debug("updating item {} statetype {}=>'{}'",rt.getClientItemName(),rt.getStateClass(),item.getStateAs(rt.getStateClass()).toString());
            beans.add(new ItemBean(rt.getClientItemName(),item.getStateAs(rt.getStateClass()).toString()));
          }
        }
        if (beans.size() > 0) {
          ItemStateListBean responseBean=new ItemStateListBean(new ItemListBean(beans));
          responseBean.index=System.currentTimeMillis();
          broadcaster.broadcast(responseBean);
        }
      }
    }
    public void stateChanged(    final Item item,    State oldState,    State newState){
      broadcaster.broadcast(item);
    }
  }
;
  registerStateChangeListenerOnRelevantItems(broadcaster.getID(),stateChangeListener);
}
